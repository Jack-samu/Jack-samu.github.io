<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Jack">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Jack">
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    <meta name="description" content="小杰的技术博客">
    <meta name="description" content="概述：web知识的前后端结合记录，专攻flask技术框架和django框架，暂时只有flask，还没更新django">
<meta property="og:type" content="article">
<meta property="og:title" content="基础web之二">
<meta property="og:url" content="https://jack-samu.github.io/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/index.html">
<meta property="og:site_name" content="Jack &#39;s Studio">
<meta property="og:description" content="概述：web知识的前后端结合记录，专攻flask技术框架和django框架，暂时只有flask，还没更新django">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jack-samu.github.io/images/WSGI%E6%95%88%E6%9E%9C.png">
<meta property="og:image" content="https://jack-samu.github.io/images/WSGI%E6%95%88%E6%9E%9C2.png">
<meta property="og:image" content="https://jack-samu.github.io/images/flask_server1.png">
<meta property="og:image" content="https://jack-samu.github.io/images/flask_server2.png">
<meta property="og:image" content="https://jack-samu.github.io/images/loginpage.png">
<meta property="og:image" content="https://jack-samu.github.io/images/flask_upload.png">
<meta property="og:image" content="https://jack-samu.github.io/images/flask_upload1.png">
<meta property="og:image" content="https://jack-samu.github.io/images/error.png">
<meta property="og:image" content="https://jack-samu.github.io/images/studentsdb.png">
<meta property="og:image" content="https://jack-samu.github.io/images/wtf%E6%9E%84%E9%80%A0%E7%9A%84%E8%A1%A8%E5%8D%95.png">
<meta property="og:image" content="https://jack-samu.github.io/images/%E8%BA%AB%E4%BB%BD%E6%B5%8B%E8%AF%95.png">
<meta property="og:image" content="https://jack-samu.github.io/images/%E5%8A%A0%E5%AF%86%E9%87%8D%E5%AE%9A%E5%90%91.png">
<meta property="article:published_time" content="2023-05-03T14:43:30.000Z">
<meta property="article:modified_time" content="2025-03-02T15:34:01.939Z">
<meta property="article:author" content="Jack">
<meta property="article:tag" content="html, css">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jack-samu.github.io/images/WSGI%E6%95%88%E6%9E%9C.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/avatar/takashi.jpg">
    <title>基础web之二 · Jack&#39;s Studio</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    <!-- 百度统计  -->
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 7.3.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu">
            <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">Jack's Studio.</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">Jack&#39;s Studio.</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">基础web之二</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/detail-head.png)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                基础web之二
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <a class="post-tag" href="javascript:void(0);" data-tags="html, css">html, css</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">16.2k</span>阅读时长: <span class="post-count reading-time">78 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2023/05/03</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p><font face="楷体"></p>
<p>概述：web知识的前后端结合记录，专攻flask技术框架和django框架，暂时只有flask，还没更新django</p>
<span id="more"></span>
<h2 id="序">序</h2>
<p>前面介绍过网页html的一些技术实现和大体架构，但对于后端boy，还是不太想计较那么多html方面的事，所以想把注意力集中回原先的python体系。针对简单的html的动态生成和一些个底层tcp/udp乃至上层http连接，都不用关注，只需要编写对应的接口响应函数，这种技术叫做WSGI，Web
Server Gateway Interface。通常编写样式都是这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>)])</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&#x27;&lt;h1&gt;Hello, wsgi!&lt;/h1&gt;&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>这么一个接口就编写完毕，但还需要进行调用，另有一个python内置了的WSGI的服务实现，叫wsgiref，可以通过这个库来调用自己编写的WSGI接口，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="comment"># 引入自己编写的接口</span></span><br><span class="line"><span class="keyword">from</span> wsgiapp <span class="keyword">import</span> application</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现一个监听8080端口、引用application自定义接口处理的server对象</span></span><br><span class="line">httpd = make_server(<span class="string">&#x27;&#x27;</span>, <span class="number">8080</span>, application)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;servint http on port 8080...&#x27;</span>)</span><br><span class="line"><span class="comment"># 持续跑起来</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>
<p>和很多程序一样，想要让它停止，就crtl+c(windows)，linux就用crtl+z来终止运行。</p>
<figure>
<img src="/images/WSGI效果.png" alt="效果" />
<figcaption aria-hidden="true">效果</figcaption>
</figure>
<p>如上就是简单的WSGI的web
app效果，不用自己编写html，它会动态生成html，客户在浏览器访问127.0.0.1:8080/就可以得到服务，当然127.0.0.1就决定了客户只能是本机PC了，哈哈哈。</p>
<p>重写一下application，使其功能丰富点： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>)])</span><br><span class="line">    <span class="comment"># 读取url中传入信息，再构造响应</span></span><br><span class="line">    body = <span class="string">&#x27;&lt;h1&gt;Hello, &#123;&#125;!&lt;/h1&gt;&#x27;</span>.<span class="built_in">format</span>(environ[<span class="string">&#x27;PATH_INFO&#x27;</span>][<span class="number">1</span>:] <span class="keyword">or</span> <span class="string">&#x27;web&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> [body.encode(<span class="string">&#x27;utf-8&#x27;</span>)]</span><br></pre></td></tr></table></figure></p>
<figure>
<img src="/images/WSGI%E6%95%88%E6%9E%9C2.png" alt="效果" />
<figcaption aria-hidden="true">效果</figcaption>
</figure>
<p>上面的框架还是比较的难维护，因为上面还没添加请求方式和不同路由的判断就还是比较简短，所以现在大多数都是用的比较流行的web框架。</p>
<h3 id="一轻便的flask">一、轻便的flask</h3>
<p>flask的使用，和上面的比较相似，都是编写对应的接口处理函数，但在使用形式上还是有差异，毕竟flask作为轻便式实现，提供了许多便利的装饰器，使用前准备：
<code>pip install flask</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, web!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>上面flask的代码实现了和最初始的web页面一样的效果，都是简单输出h1标签对应样式的hello，一开始就定义了app对象，其后的路由定义都是在app的route装饰器进行，定义完处理函数后，就run，大致就是这么个流程，如果是命令行跑起来，就需要强行要求脚本命名为app.py，如果想要自定义运行端口、ip等参数，就需要在run函数中传参了。</p>
<figure>
<img src="/images/flask_server1.png" alt="效果" />
<figcaption aria-hidden="true">效果</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhi</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;welcome, &#123;&#125;&lt;/h1&gt;&#x27;</span>.<span class="built_in">format</span>(name)</span><br></pre></td></tr></table></figure>
<figure>
<img src="/images/flask_server2.png" alt="效果" />
<figcaption aria-hidden="true">效果</figcaption>
</figure>
<p>嗯，简单实现就这样，再来多点。</p>
<h4 id="flask的各种接口的实现">1.1 flask的各种接口的实现</h4>
<p><strong>一个登录页面的实现</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 下面的html是一个用户登录页面的实现，form标签的action属性指明了请求url，method指定请求方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;form action=&quot;sign&quot; method=&quot;post&quot; style=&quot;text-align: center;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;用户名：&lt;input name=&quot;username&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;密码：&lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;&lt;button type=&quot;submit&quot;&gt;sign in&lt;/button&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/sign&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>():</span><br><span class="line">    <span class="comment"># 如果是admin用户且密码为admin就返回登录后页面，否则回应登录失败。</span></span><br><span class="line">    <span class="keyword">if</span> request.form[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> request.form[<span class="string">&#x27;password&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Welcome to the first page!&lt;/h1&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Failed in Authentication&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>效果如下： <img src="/images/loginpage.png" alt="登录页面" /> <img
src="/images/loginsuccess.png" alt="登录成功页面" /> <img
src="/images/loginerror.png" alt="登录失败页面" /></p>
<p><strong>一个图片上传实现</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;upload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;form action=&quot;upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;file&quot; name=&quot;fiiii&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;upload&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, f.filename)</span><br><span class="line">    f.save(upload_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">0</span>, <span class="string">&#x27;msg&#x27;</span>:<span class="string">&#x27;上传成功&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;上传失败&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>关于save接口，最好拼接好保存文件名再传给save参数，不然容易出现permission
error，另外就是jsonify返回响应信息中文乱码的问题，有介绍<code>app.config['JSON_AS_ASCII'] = False</code>可以，但不管用。加点东西，上传图片成功后就显示图片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;upload&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], f.filename)</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, f.filename)</span><br><span class="line">    f.save(upload_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;show/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(upload_path))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        back_msg = &#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;上传失败&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(back_msg)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">name</span>):</span><br><span class="line">    html = <span class="string">&#x27;&lt;img src=&quot;&#123;&#125;&quot; alt=&quot;&#123;&#125;&quot; height=&quot;400&quot;, width=&quot;auto&quot;&gt;&#x27;</span>.<span class="built_in">format</span>(name, name.split(<span class="string">&#x27;\\&#x27;</span>)[-<span class="number">1</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(html)</span><br><span class="line">    <span class="keyword">return</span> html</span><br></pre></td></tr></table></figure>
<p>但在上传成功后返回图片页面，但直接构造html
img的办法好像不管用，还是要手动来构造响应，或者使用template，返回构造的html模板页面。在项目中创建templates文件夹并放置下面index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>display<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;path&#125;&#125;&quot;</span>, <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;alt_name&#125;&#125;&quot;</span>, <span class="attr">height</span>=<span class="string">&quot;400&quot;</span>, <span class="attr">width</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接口的return语句修改一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;upload&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, f.filename)</span><br><span class="line">    f.save(upload_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, path=upload_path, alt_name=f.filename.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        back_msg = &#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;上传失败&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(back_msg)</span><br></pre></td></tr></table></figure>
<p>不过这样也不行，总是在get请求图片的时候失败，不知道为什么，单独构造html的时候也没问题啊，难受，只能用构造response的方法了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;upload&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, f.filename)</span><br><span class="line">    f.save(upload_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(upload_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            response = make_response(f.read())</span><br><span class="line">            response.headers[<span class="string">&#x27;content-type&#x27;</span>] = <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        back_msg = &#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;上传失败&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(back_msg)</span><br></pre></td></tr></table></figure>
<figure>
<img src="/images/flask_upload.png" alt="效果" />
<figcaption aria-hidden="true">效果</figcaption>
</figure>
<p>百度了不少，对口答案太少了，后面根据日志输出确定了图片的获取是会另外请求，而没有编写这个路由就导致了图片的html加载不完全：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    name = f.filename</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, name)</span><br><span class="line">    f.save(upload_path)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">                               path=name,</span><br><span class="line">                               alt_name=name.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        back_msg = &#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;上传失败&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(back_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错开一点，防止同名路由访问，顺带还需要修改一下index.html</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/img/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_file</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;upload/&#x27;</span>+name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        response = make_response(f.read())</span><br><span class="line">        response.headers[<span class="string">&#x27;content-type&#x27;</span>] = <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<p>因为index.html中设定img的src来源为upload_path，也即是upload/pic路径，所以要针对性写一个这样的url路由，这就是send_file的来源。
<img src="/images/flask_upload1.png" alt="输出效果" /> <img
src="/images/flask_upload2.png" alt="输出效果" /></p>
<p>本地测试html总让我有种错觉就是，html和内部的img是一体的，这个习惯要改一改。功能能跑了，完善一下，只允许图片的上传，并且根据jinja2语法加个判断，因为gif和普通图片的img属性略有不同，再修改一下样式使得它居中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> make_response</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;upload&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">ALLOW_PICS = [<span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;PNG&#x27;</span>, <span class="string">&#x27;JPG&#x27;</span>, <span class="string">&#x27;JPEG&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;GIF&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/sign&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>():</span><br><span class="line">    <span class="comment"># 下面的html是一个用户登录页面的实现，form标签的action属性指明了请求url，method指定请求方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;form action=&quot;sign&quot; method=&quot;post&quot; style=&quot;text-align: center;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;用户名：&lt;input name=&quot;username&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;密码：&lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;&lt;button type=&quot;submit&quot;&gt;sign in&lt;/button&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/sign&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">signin</span>():</span><br><span class="line">    <span class="comment"># 如果是admin用户且密码为admin就返回登录后页面，否则回应登录失败。</span></span><br><span class="line">    <span class="keyword">if</span> request.form[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> request.form[<span class="string">&#x27;password&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Welcome to the first page!&lt;/h1&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Failed in Authentication&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;form action=&quot;upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;file&quot; name=&quot;fiiii&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    f = request.files[<span class="string">&#x27;fiiii&#x27;</span>]</span><br><span class="line">    name = f.filename</span><br><span class="line">    upload_path = os.path.join(<span class="string">&#x27;upload&#x27;</span>, name)</span><br><span class="line">    <span class="keyword">if</span> f <span class="keyword">and</span> name.split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] <span class="keyword">in</span> ALLOW_PICS:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;gif&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;GIF&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">            is_gif = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_gif = <span class="literal">False</span></span><br><span class="line">        f.save(upload_path)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(upload_path):</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">                                   is_gif = is_gif,</span><br><span class="line">                                   path=upload_path,</span><br><span class="line">                                   name=name.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            jsonify(&#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">1101</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;failed in saving&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;errno&#x27;</span>:<span class="number">110</span>, <span class="string">&#x27;errmsg&#x27;</span>:<span class="string">&#x27;failed to upload, check the format&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_file</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;upload/&#x27;</span>+name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        response = make_response(f.read())</span><br><span class="line">        response.headers[<span class="string">&#x27;content-type&#x27;</span>] = <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>index.html: <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>display<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% if is_gif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;path&#125;&#125;&quot;</span>, <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span>, <span class="attr">height</span>=<span class="string">&quot;400&quot;</span>, <span class="attr">width</span>=<span class="string">&quot;auto&quot;</span> <span class="attr">loop</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoplay</span>=<span class="string">&quot;true&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;path&#125;&#125;&quot;</span>, <span class="attr">alt</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span>, <span class="attr">height</span>=<span class="string">&quot;400&quot;</span>, <span class="attr">width</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fiiii&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>好了，效果上就是每次上传图片成功都会展示，并且还可以继续上传图片。</p>
<h4 id="摸一摸jinja2语法">1.2 摸一摸jinja2语法</h4>
<p>首要的简单语法： *
<code>&#123;&#123; ... &#125;&#125;</code>，标记html中的变量，和语言沟通的变量实体；
*
<code>&#123;% ... %&#125;</code>，标记语句，各种逻辑语句诸如if、for等，都用这个，标记了开头需要标记结束；
* ``````，用来写注释语句。</p>
<p>简单的使用语句：</p>
<p><strong>变量</strong> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--name变量，在python脚本中就直接在render_template中传入指定参数即可--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello, &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>分支</strong> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% if is_or_not %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>is_or_not为true<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>is_or_not为false<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;comment.id, comment.name&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注释就自然不用多言了，很明了了。继续展开，针对变量，不同类型的变量，存储的信息也不同，比如针对python的各种标准对象诸如字典、列表等等，在python里面怎么用，在这里就怎么用。除此以外，jinja2的特色就是针对变量有着过滤器的功能，形式就是<code>&#123;&#123;变量|过滤器&#125;&#125;</code>，具体语义如下：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">过滤器名</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">safe</td>
<td style="text-align: left;">不转义</td>
</tr>
<tr class="even">
<td style="text-align: left;">capitalize</td>
<td style="text-align: left;">变量首字母大写，其余小写</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lower</td>
<td style="text-align: left;">变量小写</td>
</tr>
<tr class="even">
<td style="text-align: left;">upper</td>
<td style="text-align: left;">变量大写</td>
</tr>
<tr class="odd">
<td style="text-align: left;">title</td>
<td style="text-align: left;">变量中每个单词首字母大写</td>
</tr>
<tr class="even">
<td style="text-align: left;">trim</td>
<td style="text-align: left;">变量首尾空格去除</td>
</tr>
<tr class="odd">
<td style="text-align: left;">striptags</td>
<td style="text-align: left;">去除变量中的html标签</td>
</tr>
</tbody>
</table>
<p>它的样式是变量后加上管道符|然后接api，就有点像过滤的样子才叫过滤器吧，更多的看<a
target="_blank" rel="noopener" href="https://docs.jinkan.org/docs/jinja2/templates.html#builtin-filters">官网</a>吧。</p>
<p><strong>模板继承</strong></p>
<p>和面向对象的特性那样，jinja语法提供模板的继承，在应用当中，可以提供一个base模板，这个模板只提供关于UI界面的简单界定划分，后续的内容填充，都交给子模板。看了jinja中文网的例子，大致是这样：</p>
<p>给定一个base， <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    &#123;% block head %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125; - My Webpage<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span>&#123;% block content %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        &#123;% block footer %&#125;</span><br><span class="line">        <span class="symbol">&amp;copy;</span> Copyright 2008 by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://domain.invalid/&quot;</span>&gt;</span>you<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.</span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>block和endblock包起来的区域就是可操作区域，对于我来说就是相当于另类的虚函数，可以被子模板重写。针对base的子模板扩展：
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;Index&#123;% endblock %&#125;</span><br><span class="line">&#123;% block head %&#125;</span><br><span class="line">    &#123;&#123; super() &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.important</span> &#123; <span class="attribute">color</span>: <span class="number">#336699</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Index<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;important&quot;</span>&gt;</span></span><br><span class="line">      Welcome on my awesome homepage.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的extends表明继承于某某，super就有点类似python了，一样的意思，然后用上和base相同的block，再选择性重写里面的内容就ok了。因为引入了block的使用，它也支持嵌套概念，所以为了可读性的需求，运行在endblock的时候添加命名。</p>
<p><strong>针对循环</strong></p>
<p>在for循环中，有着方便查询当前迭代在循环中的位置的接口： |变量|描述|
|:----|:----| |loop.index|当前循环迭代的次数，从1开始|
|loop.indexo|从0开始计数的当前循环迭代次数|
|loop.revindex|到循环结束还需要迭代的次数，从1开始|
|loop.revindexo|到循环结束还需要迭代的次数，从0开始|
|loop.first|判断是否是第一次迭代| |loop.last|判断是否是最后一次迭代|
|loop.length|循环需要迭代的次数|</p>
<p>除此以外，还有一些辅助性的特殊函数，比如range、cycler等，这种接口可以查看<a
target="_blank" rel="noopener" href="https://docs.jinkan.org/docs/jinja2/templates.html#builtin-globals">中文网</a>。另外也还有更多的可用功能，但这里不想详述太多，烦人，要查的时候再看<a
target="_blank" rel="noopener" href="https://docs.jinkan.org/docs/jinja2/templates.html">中文网</a>吧。</p>
<h4 id="flask中的数据库">1.3 flask中的数据库</h4>
<p>针对sql数据库的，可以说是应用广而泛，为了争抢市场份额而出现的就有微软的SQL
server、sun的mysql，Access、DB2以及最为轻量的sqlite了。应用在web框架中的就有sqlite，有大量的数据存储访问需求的才引用mysql等数据库还有redis的缓存使用，现在好像比较热比较火的有elasticsearch和clickhouse吧，但能拿得出手的熟练的才算是自己的。</p>
<p>针对sql的使用，用过pymysql的都知道编写sql的烦恼，平白添加了一种要掌握的语法，真的烦，所以就有了ORM，这种技术就是做个中间者，python的就干python的活，操作标准的数据对象，就能通过ORM转换为操作sql。常用的就是sqlalchemy了，而flask中对应的就是Flask-SQLAlchemy，它也有着自己的ORM实现。</p>
<p><strong>简便的sqlite</strong></p>
<p>在flask中，sqlite几乎是标配了，有其他需求才会接入功能更丰富更全面的其他数据库。使用实例来进行介绍记录，最简单的就是图书管理系统或者学生信息记录系统了，首先是创建：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果存在该文件就直接连接，如果不存在就创建</span></span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;data.db&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Created or connected the database file successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行创建table的sql语句</span></span><br><span class="line">conn.execute(<span class="string">&#x27;create table students (id integer, name text, city text, phone_number text)&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Table of students has created successfully.&#x27;</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"><span class="comment"># 查表结构</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;pragma table_info(students)&#x27;</span>)</span><br><span class="line">values = cursor.fetchall()</span><br><span class="line"><span class="built_in">print</span>(values)</span><br><span class="line"><span class="comment"># 查看所有表数据</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;select * from students&#x27;</span>)</span><br><span class="line">values = cursor.fetchall()</span><br><span class="line"><span class="built_in">print</span>(values)</span><br><span class="line"><span class="comment"># 插入表数据</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;insert into students values(1, &quot;Jam&quot;, &quot;ShangHai&quot;, &quot;177&quot;)&#x27;</span>)</span><br><span class="line">cursor.execute(<span class="string">&#x27;insert into students values(2, &quot;Jack&quot;, &quot;ShangHai&quot;, &quot;170636&quot;)&#x27;</span>)</span><br><span class="line">cursor.execute(<span class="string">&#x27;insert into students values(3, &quot;May&quot;, &quot;ShangHai&quot;, &quot;1676&quot;)&#x27;</span>)</span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看表数据</span></span><br><span class="line">cursor.execute(<span class="string">&quot;select * from students&quot;</span>)</span><br><span class="line">values = cursor.fetchall()</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> values:</span><br><span class="line">    <span class="built_in">print</span>(val, <span class="built_in">type</span>(val))</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>ok，然后就是在flask中包装好数据库操作接口，变成可视化操作，从而操作后台数据库。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>学生表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">table</span>, <span class="selector-tag">th</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>:center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-collapse</span>:collapse;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">td</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">tr</span><span class="selector-class">.focus</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span><span class="selector-pseudo">:right</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#input</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>:center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">&quot;60&quot;</span>&gt;</span>学生信息统计表<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>城市<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>电话<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% for stu in students %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;stu[0]&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;stu[1]&#125;&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;stu[2]&#125;&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;stu[3]&#125;&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;modify_the_item(this)&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;delete_the_item(this)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生信息输入<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;add&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>name：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>city：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>phone：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone_number&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在这里踩了个坑，因为对js了解不够，所以主要采取html为主的编写，其中有一个想要table里面嵌套form来包含几个td，从而在button按下的时候，submit这些个td里面的数据(也就是每一行里面单个表格数据)，结果一直出问题，没法准确获取对应信息，后来了解了浏览器调试才发现问题:
<img src="/images/error.png" alt="浏览器渲染后代码" />
浏览器渲染调整以后的页面代码是上面那样的，form标签根本就没有把下面的tr给包进去，本来代码是包圆了的，查了的结果是table有自己的规则，只能整个table被form所用，不能在table里面嵌套form。大体完成的效果如下：
<img src="/images/studentsdb.png" alt="学生表" /></p>
<p>总的来说，上面的html模板代码已经可以能进行简单的使用，根据后台传入数据库中的学生信息，然后渲染，学生表数据的展示就有了，通过输入栏的信息输入，就可以添加学生信息，然后在已经展示的学生信息中，还可以进行修改和删除，但修改按钮和删除按钮还需要添加js来发起post请求，大致通过js来进行get请求和post请求的几个例子如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GET请求</span></span><br><span class="line"><span class="keyword">var</span> httpRequest = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();<span class="comment">//第一步：建立所需的对象</span></span><br><span class="line">httpRequest.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="literal">true</span>);<span class="comment">//第二步：打开连接  将请求参数写在url中  ps:&quot;./Ptest.php?name=test&amp;nameone=testone&quot;</span></span><br><span class="line">httpRequest.<span class="title function_">send</span>();<span class="comment">//第三步：发送请求  将请求参数写在URL中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取数据后的处理程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">httpRequest.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (httpRequest.<span class="property">readyState</span> == <span class="number">2</span> &amp;&amp; httpRequest.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> json = httpRequest.<span class="property">responseText</span>;<span class="comment">//获取到json字符串，还需解析</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//post，直接在url中包含请求参数</span></span><br><span class="line"><span class="keyword">var</span> httpRequest = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();<span class="comment">//第一步：创建需要的对象</span></span><br><span class="line">httpRequest.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="literal">true</span>); <span class="comment">//第二步：打开连接</span></span><br><span class="line">httpRequest.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);<span class="comment">//设置请求头 注：post方式必须设置请求头（在建立连接后设置请求头）</span></span><br><span class="line">httpRequest.<span class="title function_">send</span>(<span class="string">&#x27;name=teswe&amp;ee=ef&#x27;</span>);<span class="comment">//发送请求 将情头体写在send中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取数据后的处理程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">httpRequest.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="comment">//请求后的回调接口，可将请求成功后要执行的程序写在其中</span></span><br><span class="line">    <span class="keyword">if</span> (httpRequest.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; httpRequest.<span class="property">status</span> == <span class="number">200</span>) &#123;<span class="comment">//验证请求是否发送成功</span></span><br><span class="line">        <span class="keyword">var</span> json = httpRequest.<span class="property">responseText</span>;<span class="comment">//获取到服务端返回的数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//post一个json表单数据</span></span><br><span class="line"><span class="keyword">var</span> httpRequest = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();<span class="comment">//第一步：创建需要的对象</span></span><br><span class="line">httpRequest.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="literal">true</span>); <span class="comment">//第二步：打开连接/***发送json格式文件必须设置请求头 ；如下 - */</span></span><br><span class="line">httpRequest.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/json&quot;</span>);<span class="comment">//设置请求头 注：post方式必须设置请求头（在建立连接后设置请求头）var obj = &#123; name: &#x27;zhansgan&#x27;, age: 18 &#125;;</span></span><br><span class="line">httpRequest.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));<span class="comment">//发送请求 将json写入send中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取数据后的处理程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">httpRequest.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;<span class="comment">//请求后的回调接口，可将请求成功后要执行的程序写在其中</span></span><br><span class="line">    <span class="keyword">if</span> (httpRequest.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; httpRequest.<span class="property">status</span> == <span class="number">200</span>) &#123;<span class="comment">//验证请求是否发送成功</span></span><br><span class="line">        <span class="keyword">var</span> json = httpRequest.<span class="property">responseText</span>;<span class="comment">//获取到服务端返回的数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(json);</span><br><span class="line">        <span class="comment">//跳转到指定页面</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/newpage&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面的例子是构造http请求对象，然后再来发起get或者post请求，除此以外也可以构造form元素，然后填充数据并submit来达到同样的效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">//修改按钮点击以后，就构造表单数据，然后发起post请求</span></span><br><span class="line">    <span class="comment">//因为这里的id只是顺序，不对应数据库中的id项</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">modify_the_item</span>(<span class="params">modify_btn</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> btn_parent = modify_btn.<span class="property">parentNode</span>.<span class="property">parentNode</span></span><br><span class="line">        <span class="keyword">var</span> tmp = &#123;</span><br><span class="line">            <span class="attr">id</span>: btn_parent.<span class="property">children</span>[<span class="number">0</span>].<span class="property">innerText</span>,</span><br><span class="line">            <span class="attr">name</span>:btn_parent.<span class="property">children</span>[<span class="number">1</span>].<span class="property">innerText</span>,</span><br><span class="line">            <span class="attr">city</span>:btn_parent.<span class="property">children</span>[<span class="number">2</span>].<span class="property">innerText</span>,</span><br><span class="line">            <span class="attr">phone_number</span>:btn_parent.<span class="property">children</span>[<span class="number">3</span>].<span class="property">innerText</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;modify&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">        xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//手动创建form表单并填充数据最后submit</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">modify_the_item</span>(<span class="params">modify_btn</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> btn_parent = modify_btn.<span class="property">parentNode</span>.<span class="property">parentNode</span></span><br><span class="line">        <span class="keyword">var</span> form_tmp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;form&#x27;</span>)</span><br><span class="line">        form_tmp.<span class="property">action</span> = <span class="string">&#x27;modify&#x27;</span></span><br><span class="line">        form_tmp.<span class="property">method</span> = <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">        form_tmp.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> createInput = <span class="keyword">function</span>(<span class="params">name, val</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> inputLabel = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">            inputLabel.<span class="property">type</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">            inputLabel.<span class="property">name</span> = name</span><br><span class="line">            <span class="keyword">if</span>(val != <span class="literal">null</span>)&#123;</span><br><span class="line">                inputLabel.<span class="property">value</span> = val</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> inputLabel</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        form_tmp.<span class="title function_">appendChild</span>(<span class="title function_">createInput</span>(<span class="string">&#x27;id&#x27;</span>, btn_parent.<span class="property">children</span>[<span class="number">0</span>].<span class="property">innerText</span>))</span><br><span class="line">        form_tmp.<span class="title function_">appendChild</span>(<span class="title function_">createInput</span>(<span class="string">&#x27;name&#x27;</span>, btn_parent.<span class="property">children</span>[<span class="number">1</span>].<span class="property">innerText</span>))</span><br><span class="line">        form_tmp.<span class="title function_">appendChild</span>(<span class="title function_">createInput</span>(<span class="string">&#x27;city&#x27;</span>, btn_parent.<span class="property">children</span>[<span class="number">2</span>].<span class="property">innerText</span>))</span><br><span class="line">        form_tmp.<span class="title function_">appendChild</span>(<span class="title function_">createInput</span>(<span class="string">&#x27;phone_number&#x27;</span>, btn_parent.<span class="property">children</span>[<span class="number">3</span>].<span class="property">innerText</span>))</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">appendChild</span>(form_tmp)</span><br><span class="line">        form_tmp.<span class="title function_">submit</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交对应数据到后台删除api，然后页面也针对性进行该行数据的删除</span></span><br><span class="line">    <span class="comment">//考虑到同名数据，所以传入的表单数据就全面一点</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">delete_the_item</span>(<span class="params">delete_btn</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> btn_parent = delete_btn.<span class="property">parentNode</span>.<span class="property">parentNode</span></span><br><span class="line">        <span class="keyword">var</span> tmp = &#123;</span><br><span class="line">            <span class="attr">id</span>: btn_parent.<span class="property">children</span>[<span class="number">0</span>].<span class="property">innerText</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">        xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span><br><span class="line">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(xhr.<span class="property">readyState</span>==<span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span>==<span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">//页面上删除该数据项</span></span><br><span class="line">                btn_parent.<span class="title function_">removeChild</span>(delete_btn.<span class="property">parentNode</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>关于删除按钮的构造form实现就不展示了，有样学样即可。接下来就需要编写后台的数据了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> sqlite3 <span class="keyword">import</span> OperationalError</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">db_file = <span class="string">&#x27;students.db&#x27;</span></span><br><span class="line">db_name = <span class="string">&#x27;students&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        logger.info(<span class="string">&#x27;数据库文件已创建&#x27;</span>)</span><br><span class="line">        conn.execute(<span class="string">&#x27;drop table if exists students&#x27;</span>)</span><br><span class="line">        conn.execute(<span class="string">&#x27;create table students (id integer primary key autoincrement, &#x27;</span></span><br><span class="line">                     <span class="string">&#x27;name text unique, &#x27;</span></span><br><span class="line">                     <span class="string">&#x27;city text, &#x27;</span></span><br><span class="line">                     <span class="string">&#x27;phone_number text)&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_single_one</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        query_single_sql = <span class="string">&#x27;select * from &#123;&#125; where id=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(db_name, <span class="built_in">id</span>)</span><br><span class="line">        logger.info(<span class="string">&#x27;查单条：&#x27;</span>+query_single_sql)</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(query_single_sql)</span><br><span class="line">        <span class="keyword">return</span> cursor.fetchall()</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cursor.close()</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_all</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        query_sql = <span class="string">&#x27;select * from &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(db_name)</span><br><span class="line">        logger.info(<span class="string">&#x27;查询所有：&#x27;</span>+query_sql)</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(query_sql)</span><br><span class="line">        <span class="keyword">return</span> cursor.fetchall()</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cursor.close()</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert_single</span>(<span class="params">stu:<span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        insert_sql = <span class="string">&#x27;insert into &#123;&#125; (name, city, phone_number) &#x27;</span> \</span><br><span class="line">                     <span class="string">&#x27;values(&quot;&#123;&#125;&quot;, &quot;&#123;&#125;&quot;, &quot;&#123;&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(db_name, stu[<span class="number">0</span>],stu[<span class="number">1</span>],stu[<span class="number">2</span>])</span><br><span class="line">        logger.info(<span class="string">&#x27;插入sql:&#x27;</span>+insert_sql)</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(insert_sql)</span><br><span class="line">        conn.commit()</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_single</span>(<span class="params"><span class="built_in">id</span>:<span class="built_in">int</span>, stu:<span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        update_sql = <span class="string">&#x27;update &#123;&#125; set name=&quot;&#123;&#125;&quot;, city=&quot;&#123;&#125;&quot;, phone_number=&quot;&#123;&#125;&quot; &#x27;</span> \</span><br><span class="line">                     <span class="string">&#x27;where id=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(db_name, stu[<span class="number">0</span>], stu[<span class="number">1</span>], stu[<span class="number">2</span>], <span class="built_in">id</span>)</span><br><span class="line">        logger.info(update_sql)</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(update_sql)</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cursor.close()</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_single</span>(<span class="params"><span class="built_in">id</span>:<span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        delete_sql = <span class="string">&#x27;delete from &#123;&#125; where id=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(db_name, <span class="built_in">id</span>)</span><br><span class="line">        logger.info(<span class="string">&#x27;删除sql:&#x27;</span>+delete_sql)</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        conn.execute(delete_sql)</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#主页面</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    students = query_all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, students=students)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加信息api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>():</span><br><span class="line">    <span class="comment"># requests.form获取不到表单数据就会报400</span></span><br><span class="line">    insert_single((request.form[<span class="string">&#x27;name&#x27;</span>],request.form[<span class="string">&#x27;city&#x27;</span>],request.form[<span class="string">&#x27;phone_number&#x27;</span>]))</span><br><span class="line">    students = query_all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, students=students)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改api</span></span><br><span class="line"><span class="comment"># 其实修改这部分有点问题，就是只传入修改值，如果全部修改，就无法确定变更的数据项，所以id一项就作为不可变的值存在</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/modify&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_the_item</span>():</span><br><span class="line">    update_single(<span class="built_in">int</span>(request.form[<span class="string">&#x27;id&#x27;</span>]),</span><br><span class="line">                    (request.form[<span class="string">&#x27;name&#x27;</span>], request.form[<span class="string">&#x27;city&#x27;</span>], request.form[<span class="string">&#x27;phone_number&#x27;</span>]))</span><br><span class="line">    <span class="keyword">return</span> jsonify(<span class="string">&#x27;200&#x27;</span>, <span class="string">&#x27;修改成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_item</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    logger.info(data)</span><br><span class="line">    delete_single(<span class="built_in">int</span>(data[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    students = query_all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, students=students)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    prepare()</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>照理来说，这里代码是能正常跑的，但debug了好多好多次还是不满意，一个是redirect重定向本来是用来add这里的，方便更新数据嘛，结果一点用都没有，需要引入Ajax来进行渲染，还有就是关于request.form，如果它没法接收到数据，就会回400，调试得要命，最后就是sqlite的一些问题了，不知为何进行了delete，也执行了一下查看所有数据，但后台执行以后回头一看，数据库中依然残留着这个数据，啊吐了。</p>
<blockquote>
<p>修改思路，后台和前台的责任逻辑分得再清楚点，前台负责渲染，后台负责数据的逻辑处理，两者间的交流除了一开始的模板传递，后续的数据都只使用json来交流，这也是最简单的Ajax了。使用jquery框架，来进行页面数据的请求和渲染，然后在add请求也同样引入js手动构造table中tr、td来进行渲染的逻辑，算是很初学者了，符合我现在的状态。然后就是采用sqlite3来创表，引入dataset来进行库调用，这样可以检查执行结果。</p>
</blockquote>
<p>先修改一下数据库调用逻辑： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> sqlite3 <span class="keyword">import</span> OperationalError</span><br><span class="line"><span class="keyword">import</span> dataset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db_file = <span class="string">&#x27;students.db&#x27;</span></span><br><span class="line">db_name = <span class="string">&#x27;students&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备工作，准备一个数据表students，插入一些数据作为前端渲染展示使用</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = sqlite3.connect(db_file)</span><br><span class="line">        logger.info(<span class="string">&#x27;数据库文件已创建&#x27;</span>)</span><br><span class="line">        init_sql = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        drop table if exists students;</span></span><br><span class="line"><span class="string">        create table students (id integer primary key autoincrement,</span></span><br><span class="line"><span class="string">                     name text unique, </span></span><br><span class="line"><span class="string">                     city text, </span></span><br><span class="line"><span class="string">                     phone text);</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        insert_sql = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        insert into students (name, city, phone) values (&quot;ban&quot;, &quot;高村&quot;, &quot;13212&quot;);</span></span><br><span class="line"><span class="string">        insert into students (name, city, phone) values (&quot;明&quot;, &quot;London&quot;, &quot;98797&quot;);</span></span><br><span class="line"><span class="string">        insert into students (name, city, phone) values (&quot;鬼&quot;, &quot;贵&quot;, &quot;6327826&quot;);</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> conn:</span><br><span class="line">            conn.executescript(init_sql)</span><br><span class="line">            conn.executescript(insert_sql)</span><br><span class="line">            conn.commit()</span><br><span class="line">    <span class="keyword">except</span> OperationalError <span class="keyword">as</span> err:</span><br><span class="line">        logger.error(err.args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取table操作对象</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    db = dataset.connect(<span class="string">&#x27;sqlite:///&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(db_file))</span><br><span class="line">    <span class="keyword">return</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_single_one</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">with</span> get_db() <span class="keyword">as</span> db:</span><br><span class="line">        table = db[db_name]</span><br><span class="line">        res = table.find_one(<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line">        student = &#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> res.items()&#125;</span><br><span class="line">        logger.info(student)</span><br><span class="line">        <span class="keyword">return</span> student</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_all</span>():</span><br><span class="line">    <span class="keyword">with</span> get_db() <span class="keyword">as</span> db:</span><br><span class="line">        table = db[db_name]</span><br><span class="line">        students = [&#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> row.items()&#125; <span class="keyword">for</span> row <span class="keyword">in</span> table]</span><br><span class="line">        logger.info(students)</span><br><span class="line">        <span class="keyword">return</span> students</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回插入row的id</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert_single</span>(<span class="params">stu:<span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="keyword">with</span> get_db() <span class="keyword">as</span> db:</span><br><span class="line">        table = db[db_name]</span><br><span class="line">        logger.info(<span class="string">&#x27;待插入学生信息：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu))</span><br><span class="line">        res = table.insert(stu)</span><br><span class="line">        db.commit()</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 成功就返回1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_single</span>(<span class="params">stu:<span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="keyword">with</span> get_db() <span class="keyword">as</span> db:</span><br><span class="line">        table = db[db_name]</span><br><span class="line">        logger.info(<span class="string">&#x27;待更新信息：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu))</span><br><span class="line">        res = table.update(stu, [<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回True或者False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_single</span>(<span class="params"><span class="built_in">id</span>:<span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">with</span> get_db() <span class="keyword">as</span> db:</span><br><span class="line">        table = db[db_name]</span><br><span class="line">        logger.info(<span class="string">&#x27;待删除id:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>))</span><br><span class="line">        <span class="keyword">return</span> table.delete(<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br></pre></td></tr></table></figure></p>
<p>还有api逻辑的修改： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主页面</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续ajax主动请求学生信息所在</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/list&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_list</span>():</span><br><span class="line">    students = query_all()</span><br><span class="line">    <span class="keyword">return</span> students, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加信息api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>():</span><br><span class="line">    <span class="comment"># requests.form获取不到表单数据就会报400</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    logger.info(data)</span><br><span class="line">    res = insert_single(data)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">        student = query_single_one(res)</span><br><span class="line">        <span class="keyword">return</span> student, <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;failed&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改api</span></span><br><span class="line"><span class="comment"># 其实修改这部分有点问题，就是只传入修改值，如果全部修改，就无法确定变更的数据项，所以id一项就作为不可变的值存在</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/modify&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_the_item</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    res = update_single(data)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;success&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;failed&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_item</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    logger.info(<span class="built_in">type</span>(data[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    res = delete_single(data[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;success&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;failed&#x27;</span>), <span class="number">500</span></span><br></pre></td></tr></table></figure></p>
<p>然后是在前端页面的修改，去除jinja2语法的渲染，改为js负责：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>学生表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://lib.baomitu.com/jquery/1.12.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">table</span>, <span class="selector-tag">th</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>:center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-collapse</span>:collapse;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">td</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">tr</span><span class="selector-class">.focus</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span><span class="selector-pseudo">:right</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#input</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>:center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">&quot;60&quot;</span>&gt;</span>学生信息统计表<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;showmsg&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>城市<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>电话<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>学生信息输入<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>name：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>city：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>phone：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;add_item(this)&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//添加ajax请求，完成对展示数据的渲染</span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;list&#x27;</span>, &#123;<span class="attr">method</span>:<span class="string">&#x27;GET&#x27;</span>&#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">resp</span>)=&gt;</span>resp.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function">(<span class="params">text</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            students = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(text)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> table_handler = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;showmsg&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> students)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> new_tr = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;id&#x27;</span>, students[i].<span class="property">id</span>, <span class="literal">false</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;name&#x27;</span>, students[i].<span class="property">name</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;city&#x27;</span>, students[i].<span class="property">city</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;phone&#x27;</span>, students[i].<span class="property">phone</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>, <span class="literal">true</span>))</span></span><br><span class="line"><span class="language-javascript">                table_handler.<span class="title function_">appendChild</span>(new_tr)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//暂时还不太明了如何针对input值的前后变化，针对没有确切的修改就只alert而不回退之前状态</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> modify_item = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> btn_parent = <span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> tmp = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>:<span class="title class_">Number</span>(btn_parent.<span class="property">children</span>[<span class="number">0</span>].<span class="property">innerText</span>),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>:btn_parent.<span class="property">children</span>[<span class="number">1</span>].<span class="property">children</span>[<span class="number">0</span>].<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">city</span>:btn_parent.<span class="property">children</span>[<span class="number">2</span>].<span class="property">children</span>[<span class="number">0</span>].<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">phone</span>:btn_parent.<span class="property">children</span>[<span class="number">3</span>].<span class="property">children</span>[<span class="number">0</span>].<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;modify&#x27;</span>, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(xhr.<span class="property">readyState</span>!=<span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span>!=<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&#x27;修改失败，检查是否确切修改了原值&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//针对删除按钮的使用</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> delete_item = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> btn_parent = <span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="property">parentNode</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> tmp = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>:<span class="title class_">Number</span>(btn_parent.<span class="property">children</span>[<span class="number">0</span>].<span class="property">innerText</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;待删除项id:&#x27;</span>+tmp)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(xhr.<span class="property">readyState</span>==<span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span>==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> table_handler = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;showmsg&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                table_handler.<span class="title function_">removeChild</span>(btn_parent)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> create_td = <span class="keyword">function</span>(<span class="params">key, value, edit_or_not, has_button</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> new_td = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;td&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span>(edit_or_not)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> new_input = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            new_input.<span class="property">type</span> = <span class="string">&#x27;text&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            new_input.<span class="property">name</span> = key</span></span><br><span class="line"><span class="language-javascript">            new_input.<span class="property">value</span> = value</span></span><br><span class="line"><span class="language-javascript">            new_td.<span class="title function_">appendChild</span>(new_input)</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(has_button) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> new_modify_button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            new_modify_button.<span class="property">innerText</span> = <span class="string">&quot;修改&quot;</span></span></span><br><span class="line"><span class="language-javascript">            new_modify_button.<span class="property">onclick</span> = modify_item</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> new_delete_button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            new_delete_button.<span class="property">innerText</span> = <span class="string">&quot;删除&quot;</span></span></span><br><span class="line"><span class="language-javascript">            new_delete_button.<span class="property">onclick</span> = delete_item</span></span><br><span class="line"><span class="language-javascript">            new_td.<span class="title function_">appendChild</span>(new_modify_button)</span></span><br><span class="line"><span class="language-javascript">            new_td.<span class="title function_">appendChild</span>(new_delete_button)</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            new_td.<span class="property">innerText</span> = value</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> new_td</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">add_item</span>(<span class="params">add_btn</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//应该对应的form元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> btn_parent = add_btn.<span class="property">parentNode</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> tmp = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>:btn_parent.<span class="property">children</span>[<span class="number">2</span>].<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">city</span>:btn_parent.<span class="property">children</span>[<span class="number">5</span>].<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">phone</span>:btn_parent.<span class="property">children</span>[<span class="number">8</span>].<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (tmp.<span class="property">name</span>!=<span class="string">&quot;&quot;</span> &amp;&amp; tmp.<span class="property">city</span>!=<span class="string">&quot;&quot;</span> &amp;&amp; tmp.<span class="property">phone</span>!=<span class="string">&quot;&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;add&#x27;</span>, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tmp))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> table_handler = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;showmsg&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (xhr.<span class="property">readyState</span>==<span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span>==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> res_json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(res_json)</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//开始渲染</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> show_table = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;showmsg&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> new_tr = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;id&#x27;</span>, res_json.<span class="property">id</span>, <span class="literal">false</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                    new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;name&#x27;</span>, res_json.<span class="property">name</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                    new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;city&#x27;</span>, res_json.<span class="property">city</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                    new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;phone&#x27;</span>, res_json.<span class="property">phone</span>, <span class="literal">true</span>, <span class="literal">false</span>))</span></span><br><span class="line"><span class="language-javascript">                    new_tr.<span class="title function_">appendChild</span>(<span class="title function_">create_td</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>, <span class="literal">true</span>))</span></span><br><span class="line"><span class="language-javascript">                    show_table.<span class="title function_">appendChild</span>(new_tr)</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;不能置空&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>好了，总算达成我要的效果了，接下来后台的逻辑已经定下了，最多就更换数据库然后改写数据库调用接口的逻辑就完了。<a
target="_blank" rel="noopener" href="https://gitee.com/jacksamu/flask-full-stack/tree/v1.0">项目地址</a>，暂时就只是简单版，后面会持续更新迭代。很少进行版本控制，这里记录一下，免得忘了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git clone 一下项目</span><br><span class="line">cd 项目</span><br><span class="line">git add .</span><br><span class="line">git status 看看添加情况</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">commit然后打tag</span></span><br><span class="line">git commit -m &#x27;first commit&#x27; </span><br><span class="line">git tag -a v1.0 -m &quot;version 1.0&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交</span></span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交了tag页面上才有tag刷新显示</span></span><br><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>
<p>然后在我把代码结构进行解耦后提交出现被reject的问题，然后这么解决了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase origin master</span><br><span class="line">git pull origin master</span><br></pre></td></tr></table></figure>
<p><strong>引入ORM的实现</strong></p>
<p>ORM在python中，就是自定义一个对照数据表中数据项的类，操作这个类，就可以达到操作数据表的效果。之前使用sqlite3可以说是很原始的类sql的操作了，而且无法得到操作的成功与否的结果，从而有效执行正确的逻辑。另外的，针对这种情况的OR
Mapper在python中就是SQLAlchemy，在flask中也有着自己的扩展flask-sqlalchemy，ORM是Object
Relation
Mapping，就是对象关系映射，对象就是高级语言中的对象，对应python就是自定义类，关系是关系型数据库中的比较重要的概念，两者相映射，就是python中做着自己的东西就能操作关系型数据库中数据表了，也就不同编写原始SQL了。</p>
<p>库依赖： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask_sqlalchemy</span><br></pre></td></tr></table></figure></p>
<p>引入ORM以后，想要不改变原有逻辑的情况，针对自定义类转为json的逻辑就很让我头疼，所以给自定义类加上了成员函数来构造一个对应dict，方便返回给客户端，此外，之前解耦出来的独立的数据库模块在引入了ORM重新实现后，又融进了app.py主体中，毕竟程序主体不大。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;sqlite:///students.db&#x27;</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 映射数据表中的对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Students</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;students&#x27;</span></span><br><span class="line">    <span class="comment"># 声明数据成员</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(<span class="string">&#x27;id&#x27;</span>, db.Integer, primary_key = <span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(<span class="string">&#x27;name&#x27;</span>, db.String(<span class="number">30</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    city = db.Column(<span class="string">&#x27;city&#x27;</span>, db.String(<span class="number">30</span>))</span><br><span class="line">    phone = db.Column(<span class="string">&#x27;phone&#x27;</span>, db.String(<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, city, phone</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.city = city</span><br><span class="line">        <span class="variable language_">self</span>.phone = phone</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">jsonformat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>:<span class="variable language_">self</span>.<span class="built_in">id</span>,</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>:<span class="variable language_">self</span>.name,</span><br><span class="line">            <span class="string">&#x27;city&#x27;</span>:<span class="variable language_">self</span>.city,</span><br><span class="line">            <span class="string">&#x27;phone&#x27;</span>:<span class="variable language_">self</span>.phone</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare</span>():</span><br><span class="line">    <span class="comment"># 创建uri指定数据库</span></span><br><span class="line">    db.drop_all()</span><br><span class="line">    db.create_all()</span><br><span class="line">    db.session.add(Students(<span class="string">&quot;ban&quot;</span>, <span class="string">&quot;高村&quot;</span>, <span class="string">&quot;13212&quot;</span>))</span><br><span class="line">    db.session.add(Students(<span class="string">&quot;明&quot;</span>, <span class="string">&quot;London&quot;</span>, <span class="string">&quot;98797&quot;</span>))</span><br><span class="line">    db.session.add(Students(<span class="string">&quot;鬼&quot;</span>, <span class="string">&quot;贵&quot;</span>, <span class="string">&quot;6327826&quot;</span>))</span><br><span class="line">    db.session.commit()</span><br></pre></td></tr></table></figure>
<p>数据库部分逻辑，然后是api设计：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主页面</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续ajax主动请求学生信息所在</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/list&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_list</span>():</span><br><span class="line">    students = Students.query.<span class="built_in">all</span>()</span><br><span class="line">    students = [s.jsonformat() <span class="keyword">for</span> s <span class="keyword">in</span> students]</span><br><span class="line">    logger.info(students)</span><br><span class="line">    <span class="keyword">return</span> jsonify(students), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加信息api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>():</span><br><span class="line">    <span class="comment"># requests.form获取不到表单数据就会报400</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    stu_additon = Students(data[<span class="string">&#x27;name&#x27;</span>], data[<span class="string">&#x27;city&#x27;</span>], data[<span class="string">&#x27;phone&#x27;</span>])</span><br><span class="line">    logger.info(stu_additon.jsonformat())</span><br><span class="line">    db.session.add(stu_additon)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    student = Students.query.filter_by(name=data[<span class="string">&#x27;name&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> student != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(student.jsonformat()), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;failed&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改api</span></span><br><span class="line"><span class="comment"># 这里还是没处理好，前端需要针对改变项进行识别并提交，id作为不可变项一起提交就好</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/modify&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_the_item</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    <span class="comment"># 提出来</span></span><br><span class="line">    stu_modify = Students.query.filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> stu_modify != <span class="literal">None</span>:</span><br><span class="line">        logger.info(<span class="string">&#x27;修改前：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_modify.jsonformat()))</span><br><span class="line">        stu_modify.name, stu_modify.city, stu_modify.phone = data[<span class="string">&#x27;name&#x27;</span>], data[<span class="string">&#x27;city&#x27;</span>], data[<span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">        db.session.commit()</span><br><span class="line">        stu_after = Students.query.filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">        logger.info(<span class="string">&#x27;修改后：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_after.jsonformat()))</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;got it&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&quot;failed caused it&#x27;s not there&quot;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_item</span>():</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    logger.info(<span class="built_in">type</span>(data[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    stu_delete = Students.query.filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> stu_delete != <span class="literal">None</span>:</span><br><span class="line">        logger.info(<span class="string">&#x27;准备删除信息：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_delete.jsonformat()))</span><br><span class="line">        res = db.session.delete(stu_delete)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;删除结果：&#x27;</span>,res)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;success&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&quot;failed caused it&#x27;s not there&quot;</span>), <span class="number">500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因为自定义类的设计需要继承自db.Model这一由SQLAlchemy传入app对象创建的对象，所以暂时没有解耦的思路。所以暂时就<a
target="_blank" rel="noopener" href="https://gitee.com/jacksamu/flask-full-stack/tree/v1.1">这样</a>，或许后续应用到'池'的概念的时候就可以考虑解耦了。</p>
<h3 id="引入mysql数据库">1.4 引入Mysql数据库</h3>
<p>关于mysql的python操作库，有着pymysql和sqlalchemy，在pymysql的操作，大体上还是走的execute对应sql语句的路子，而sqlalchemy则是和上面的flask_sqlalchemy类似，实际上应该说是flask针对sqlalchemy进行的扩展支持，用来支持ORM技术。具体的一个练习，可以查看我的另外一篇<a
target="_blank" rel="noopener" href="https://jacksamu.gitee.io/2023/04/26/python的sql连接/">小记录</a></p>
<p>和上面不同的地方，就只是修改一下配置和数据库url，其他的增删改查api倒是一致：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DIALECT = <span class="string">&#x27;mysql&#x27;</span>       <span class="comment"># 数据库类型</span></span><br><span class="line">DRIVER = <span class="string">&#x27;pymysql&#x27;</span>      <span class="comment"># 数据库驱动</span></span><br><span class="line">USER = <span class="string">&#x27;jam&#x27;</span>            <span class="comment"># 用户名</span></span><br><span class="line">PWD = <span class="string">&#x27;jam123@&#x27;</span>         <span class="comment"># 用户密码</span></span><br><span class="line">HOST = <span class="string">&#x27;192.168.1.7&#x27;</span>    <span class="comment"># 数据库所在主机</span></span><br><span class="line">PORT = <span class="string">&#x27;3306&#x27;</span>           <span class="comment"># 数据库端口</span></span><br><span class="line">DATABASE = <span class="string">&#x27;somedb&#x27;</span>     <span class="comment"># 所操作的mysql中database</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;&#x27;&#x27;&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">    DIALECT, DRIVER, USER, PWD, HOST, PORT, DATABASE</span><br><span class="line">)</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">db = SQLAlchemy(app)</span><br></pre></td></tr></table></figure>
<p>不过使用前记得安装pymysql驱动，不然会出错，因为在pycharm中测试，因为是虚拟环境，所以在本机安装的pymysql下意识就以为有安装了。另外就是又遇到了密码中有@字符，导致数据库uri解析有误，从而使得数据库连接失败，所以上面的uri部分得修改一下，在PWD传入之前使用urllib.parse.quote_plus进行修改一下，就可以了。</p>
<h4 id="引入用户登录">1.4.1 引入用户登录</h4>
<p>如果仅仅是更换个数据库，其实没啥子意思，再加点功能算了，添加上用户登录，并使用cookie进行维持。</p>
<p>这里引入各种其他的插件，首先是Flask
WTF，在html中提交表单数据，会使用到form元素，不过很多都说它会在前端html中构建一次然后在发送了表单数据后服务端再根据表单数据再构造一次；还有就是form表单难以进行渲染和验证，可能准确点就是和python或者其他渲染技术不匹配吧。因为这些种种原因，就有了flask-WTF，是的(What
The
Fuck，是我第一感觉)，在我看来，最有用的估计就是帮助进行CSRF验证了。</p>
<p>使用前：<code>pip install flask-wtf</code>，先要安装了扩展才能用。定义一下wtf里面的form：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField, PasswordField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&quot;username: &quot;</span>, validators=[DataRequired(<span class="string">&quot;Please enter your name.&quot;</span>)])</span><br><span class="line">    pwd = PasswordField(<span class="string">&quot;password: &quot;</span>, validators=[DataRequired(<span class="string">&quot;Please enter your password.&quot;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&quot;Send&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>然后是简单调用检验：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> login <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="comment"># flask会默认把form构造的数据放进去</span></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        name = form.name.data</span><br><span class="line">        pwd = form.pwd.data</span><br><span class="line">        <span class="built_in">print</span>(name, pwd)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;Welcome&lt;/h1&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>还有对应的模板html：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span> = <span class="string">&quot;text-align: center;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span> = <span class="string">&quot;http://localhost:5000/login&quot;</span> <span class="attr">method</span> = <span class="string">post</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">legend</span>&gt;</span>login Form<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.csrf_token&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span> =<span class="string">&quot;font-size:20px;font-weight:bold;margin-left:150px;&quot;</span>&gt;</span></span><br><span class="line">               &#123;&#123; form.name.label &#125;&#125;</span><br><span class="line">               &#123;&#123; form.name &#125;&#125;</span><br><span class="line">               <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">               &#123;&#123; form.pwd.label &#125;&#125;</span><br><span class="line">               &#123;&#123; form.pwd &#125;&#125;</span><br><span class="line">               <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">               &#123;&#123; form.submit &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实主要就是form部分，使用前面构建的LoginForm类创建的form对象来进行渲染。跑起来的结果就是下面这样的：</p>
<figure>
<img src="/images/wtf构造的表单.png" alt="表单样式" />
<figcaption aria-hidden="true">表单样式</figcaption>
</figure>
<p>图片里面就展示了WTF中支持的StringField、SubmitField和PasswordField的渲染样式，分别对应的是html中的输入框、可选框和确认button了，进行过html设计的都不算陌生。除此以外，还有着BooleanField和DecimalField这些个可选支持，但很多例子都很老，而且要反复修改，诸如以前的TextField还有flask_wtf.Form等等老例子中常用的，都出现了或多或少的改动，有的干脆就没了。</p>
<p>TODO：这一部分主要是要拓展表单的构建部分。</p>
<h4 id="session和cookie">1.4.2 session和cookie</h4>
<p>从前面到现在，一直进行的都是无状态的http的练习，都是客户端和服务端的一来一往的对话式的请求和响应服务。但在很多情况下，比如一些需要登录的情况，就需要对用户身份进行识别和维护了，cookie就是客户端里用来标识用户身份的一个信息记录。在flask中，cookie的使用，可以通过构造响应，在用户初次访问的时候，回应一个带有Set-Cookie字段的响应，后续客户端的请求都得带着这个cookie来进行检验了。如下，设计一个登录页面，然后在前端发起表单数据的request以后，构造一个带有Set-Cookie字段的响应给客户端。</p>
<p>在上面的登录页面添加上响应构造：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    form = TestForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.name.data</span><br><span class="line">            pwd = form.pwd.data</span><br><span class="line">            logger.info(name, pwd)</span><br><span class="line">            resp = make_response(redirect(<span class="string">&#x27;/hello&#x27;</span>))</span><br><span class="line">            resp.set_cookie(<span class="string">&#x27;user&#x27;</span>, <span class="built_in">str</span>(name), max_age=<span class="number">18000</span>)</span><br><span class="line">            <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure>
<p>如上所示，在前面的login路由处理中进行修改，在确定了post请求且wtform表单数据符合预设规则后，就构造一个重定向response，然后设置set_cookie字段，后续的各种处理函数都可以使用cookie作为身份校验了。到浏览器看看cookie信息。嗯，差不多就下面这样吧：</p>
<figure>
<img src="/images/身份测试.png" alt="cookie信息" />
<figcaption aria-hidden="true">cookie信息</figcaption>
</figure>
<p>重定向的欢迎路由：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    user = request.cookies.get(<span class="string">&#x27;user&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> user != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;Welcome, &#123;&#125;&lt;/h1&gt;&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(user)</span><br></pre></td></tr></table></figure>
<p>如上设置了cookie的信息获取，字段名要对得上。其实到了这里，使用cookie就像只是添加了个出入资格，有这个cookie的都可以凭借这个身份拥有访问服务的资格，实际上也还算是会话不持续的服务应答。所以下面引入session，这里的session使用起来比较像字典，它的存在也是为了长久保存用户信息，使用起来，和前面cookie差不多。</p>
<p>首先是在app设置中设定secret_key，可以是任意字符串，同时设置存活时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>] = timedelta(minutes=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>然后这个session信息会在加密后丢到cookie中，保留在客户端中，然后使用上没多大样式的差别：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    user = session.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> user != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Welcome, &#123;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;logout&quot;&gt;退出&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(user)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Access Denied.Please login.&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;/&quot;&gt;退出&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置cookie后跳转</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    form = TestForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.name.data</span><br><span class="line">            pwd = form.pwd.data</span><br><span class="line">            logger.info(name, pwd)</span><br><span class="line">            session[<span class="string">&#x27;user&#x27;</span>] = name</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;hello&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bye</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;Bye, you&#x27;re outside.See you.&lt;/h1&gt;&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如上，添加一个退出的处理，在退出的时候进行session的清理，其他的没多大区别。不过有时候不长记性，总在return一个html语句的时候就加上url_for，还有url_for在代码中往往传参的是一个视图函数名，但总是用上路由名，不长记性啊。</p>
<h4 id="用于登录的flask_login">1.4.3 用于登录的flask_login</h4>
<p>flask是一个轻量型的web框架，这也意味着它支持扩展，需要很多第三方库来对它实现各种功能提供支持，flask_login就是这么一个。它的应用，可以在会话中存储活跃的用户ID，使得访问自由，这就是session的应用了；还有就是针对各种持续性认证和限制访问可以有很好的支持，最后就是一个cookie安全的问题。嗯，还有个很有意思的认证，它可以加上flask_httpauth来一起进行用户认证，或是其他插件，环环相扣，了解一个成型的web，就需要抽丝剥茧，做成一个成熟的web也需要层层叠加，耦合又解耦。</p>
<p>关于flask的各种好用的扩展，诸如flask-sqlalchemy、flask-email等等，可以在<a
href="pypi.org/search">pypi官网搜索页面</a>输入Framework::Flask来搜索想要的扩展。</p>
<p>这里使用flask_login来进行登录的尝试，首要的当然是安装：<code>pip install flask_login</code></p>
<p>然后就是在app中进行flask_login的引入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">login_manager = LoginManager()</span><br><span class="line">login_manager.init_app(app)</span><br></pre></td></tr></table></figure>
<p>这就算把app应用和flask_login绑在一起了，LoginManager管理者可以针对自定义的用户类进行用户ID的加载，并且维持在session中，不过要做到这个就需要自定义用户类提供一个user_loader的回调在类成员中。还有就是实现is_authenticated、is_active、is_anonymous这些成员函数来对登录、活跃、匿名提供支持，get_id也是需要的，它提供给前面的user_loader来进行类的ID调用。一个自定义类大致就这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> UserMixin</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserMixin提供了下面方法的默认实现，这里就算重写一遍了</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户认证通过时，提供有效证明时回True</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_authenticated</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 已验证通过、已激活、未停用的账户，那就返回True</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_active</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># 如果是既定anonymous用户就返回True</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_anonymous</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 返回一个用户标识，并能用于从user_loader回调中加载的unicode</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_id</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> unicode(<span class="variable language_">self</span>.userid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当没有sessionID的时候，可以通过装饰器指定的函数来读取用户到session中，</span></span><br><span class="line"><span class="comment"># 达到前端中调用当前登录用户current_user的目的</span></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">userid</span>):</span><br><span class="line">    <span class="keyword">return</span> User.get(userid)</span><br></pre></td></tr></table></figure>
<p>类搞定了，对于其他的路由处理函数来说，无非就登录路由、退出路由和登录才能使用的和非登录就能使用的路由了，login和logout。flask_login提供了将user属性写入session，并绑定到当前请求上下文的login_user，每次http请求的发起都会创建一个请求上下文，所以每次请求的发生都需要获取user查看属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> login_user, logout_user</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 使用wtform</span></span><br><span class="line">    form = UserForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        ...</span><br><span class="line">        login_user(user)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;Welcome.&lt;/h1&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hhhhhhhhhhhhhhh&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;home&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>因为自定义类还包含了db.Model，也就意味着它还是ORM的数据库操作类，所以它还有着另一部分内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    phone_number = Column(String(<span class="number">16</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    email = Column(String(<span class="number">64</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line">    token = Column(String(<span class="number">64</span>))</span><br><span class="line">    password = Column(<span class="string">&#x27;password&#x27;</span>, String(<span class="number">100</span>))</span><br><span class="line">    status = Column(Integer, default=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">type</span> = Column(Integer, default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>所以这个类的操作就同时对钩数据库存储和login操作了，是很重要的数据类了。实战一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, session, url_for, flash</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager, login_user, logout_user, UserMixin, login_required, current_user, confirm_login</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField, PasswordField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired, EqualTo, Length</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sql_uri = <span class="string">&#x27;&#x27;&#x27;&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">    <span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;pymysql&#x27;</span>, <span class="string">&#x27;jam&#x27;</span>, quote_plus(<span class="string">&#x27;jam123@&#x27;</span>), <span class="string">&#x27;192.168.1.7&#x27;</span>, <span class="string">&#x27;3306&#x27;</span>, <span class="string">&#x27;somedb&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;login&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = sql_uri</span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line">login_manager= LoginManager(app)</span><br><span class="line">login_manager.login_view = <span class="string">&#x27;login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    <span class="built_in">id</span>=db.Column(db.Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">True</span>)</span><br><span class="line">    pwd = db.Column(db.String(<span class="number">20</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> cls.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="keyword">return</span> User.query.get(<span class="built_in">int</span>(user_id))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;用户名：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户名&#x27;</span>), Length(<span class="built_in">min</span>=<span class="number">2</span>, <span class="built_in">max</span>=<span class="number">20</span>)])</span><br><span class="line">    pwd = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户密码&#x27;</span>)])</span><br><span class="line">    pwd1 = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;再次输入用户密码&#x27;</span>),</span><br><span class="line">                                            EqualTo(<span class="string">&#x27;pwd&#x27;</span>, message=<span class="string">&#x27;前后密码不一致&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Sign up&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;用户名：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户名&#x27;</span>), Length(<span class="built_in">min</span>=<span class="number">2</span>, <span class="built_in">max</span>=<span class="number">20</span>)])</span><br><span class="line">    pwd = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户密码&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> confirm_login():</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;Welcome home, &#123;&#125;.&lt;/h1&gt;&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(current_user.name)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db.session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                user = User(name=form.name.data, pwd=form.pwd.data)</span><br><span class="line">                db.session.add(user)</span><br><span class="line">                db.session.commit()</span><br><span class="line">                login_user(user)</span><br><span class="line">                <span class="comment"># 可以进行next检查</span></span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error = <span class="string">&#x27;用户已注册，请检查输入信息&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db.session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> user.pwd==form.pwd.data:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;register&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error=form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        db.drop_all()</span><br><span class="line">        db.create_all()</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>在实际操作中，总是在user_loadr的时候出错，因为刚好碰上了sqlalchemy更换大版本，以前的<code>orm.query,get(id)</code>一直使用出错，来来回回搞得让人身心疲惫。它需要有这么一个获取userID的方法来进行获取，从而确定登录状态，项目代码实在太庞大，只好暂时放弃flask-login的方案了，把失败代码放上去，看以后怎么解决。
<a
target="_blank" rel="noopener" href="https://gitee.com/jacksamu/failure-record/tree/master/login_tst">代码地址</a>
<a
target="_blank" rel="noopener" href="http://www.pythondoc.com/flask-login/index.html">flask_login官方文档</a></p>
<h4 id="更换实现">1.4.4 更换实现</h4>
<p>前面的实验很珍贵，但时间不够，放弃flask_login这个插件，自我实现简单的登录和校验吧。啊，真的要命，终于可以了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template,redirect, request, flash, session</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, PasswordField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired, Length, EqualTo</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine, Column, String, Integer</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker, declarative_base</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">sql_uri = <span class="string">&#x27;&#x27;&#x27;&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">    <span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;pymysql&#x27;</span>, <span class="string">&#x27;jam&#x27;</span>, quote_plus(<span class="string">&#x27;jam123@&#x27;</span>), <span class="string">&#x27;192.168.1.7&#x27;</span>, <span class="string">&#x27;3306&#x27;</span>, <span class="string">&#x27;somedb&#x27;</span></span><br><span class="line">)</span><br><span class="line">engine = create_engine(sql_uri)</span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">db_session = Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>] = timedelta(minutes=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment"># orm数据表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">True</span>)</span><br><span class="line">    pwd = Column(String(<span class="number">20</span>), unique=<span class="literal">True</span>, nullable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User &#123;&#125;&gt;&#x27;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册表单</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;用户名：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户名&#x27;</span>), Length(<span class="built_in">min</span>=<span class="number">2</span>, <span class="built_in">max</span>=<span class="number">20</span>)])</span><br><span class="line">    pwd = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户密码&#x27;</span>)])</span><br><span class="line">    pwd1 = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;再次输入用户密码&#x27;</span>),</span><br><span class="line">                                            EqualTo(<span class="string">&#x27;pwd&#x27;</span>, message=<span class="string">&#x27;前后密码不一致&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Sign up&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录表单</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;用户名：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户名&#x27;</span>), Length(<span class="built_in">min</span>=<span class="number">2</span>, <span class="built_in">max</span>=<span class="number">20</span>)])</span><br><span class="line">    pwd = PasswordField(<span class="string">&#x27;密码：&#x27;</span>, validators=[DataRequired(<span class="string">&#x27;请输入用户密码&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, title=<span class="string">&#x27;home&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db_session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            logger.info(user)</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                name, pwd = form.name.data, form.pwd.data</span><br><span class="line">                db_session.add(User(name=name, pwd=pwd))</span><br><span class="line">                db_session.commit()</span><br><span class="line">                flash(<span class="string">&#x27;注册成功&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error = <span class="string">&#x27;用户已存在，请检查信息&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form, error=error)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db_session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            logger.info(user)</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> user.pwd == form.pwd.data:</span><br><span class="line">                    session.clear()</span><br><span class="line">                    session[<span class="string">&#x27;user_id&#x27;</span>] = user.<span class="built_in">id</span></span><br><span class="line">                    <span class="keyword">return</span> redirect(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    error = <span class="string">&#x27;用户密码错误&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flash(<span class="string">&#x27;用户不存在&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;register&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        user = db_session.query(User).filter_by(<span class="built_in">id</span>=<span class="built_in">int</span>(user_id)).first()</span><br><span class="line">        logger.info(user)</span><br><span class="line">    session.pop(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        user = db_session.query(User).filter_by(<span class="built_in">id</span>=<span class="built_in">int</span>(user_id)).first()</span><br><span class="line">        logger.info(user)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Welcome home, &#123;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;logout&quot;&gt;退出&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(user)</span><br><span class="line">    flash(<span class="string">&#x27;登录已失效&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        Base.metadata.drop_all(engine)</span><br><span class="line">        Base.metadata.create_all(engine)</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>测试代码，针对数据库的drop_all需要删除，在实操中遇到的sql操作的各种api也实在是有问题，经验还是不足，对mysql用得少。因为前面成功了，所以重新使用flask_login进行了实现，发现就ok了，看来还是使用的不够，怀疑还是sql-api的使用问题。<a
target="_blank" rel="noopener" href="https://gitee.com/jacksamu/failure-record/tree/master/login_tst/success">仓库地址</a></p>
<h3 id="添加了登录">1.5 添加了登录</h3>
<p>暂时就这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, jsonify, redirect, flash</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> login_user, login_manager, login_required, logout_user, LoginManager, current_user</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义包</span></span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> Base, engine, db_session, User, Students</span><br><span class="line"><span class="keyword">from</span> form.form <span class="keyword">import</span> RegisterForm, LoginForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"><span class="comment"># 设置session持续时间为一周</span></span><br><span class="line">app.config[<span class="string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>] = timedelta(weeks=<span class="number">1</span>)</span><br><span class="line">login_manager = LoginManager()</span><br><span class="line">login_manager.init_app(app)</span><br><span class="line">login_manager.login_view = <span class="string">&#x27;login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册用来获取用户的回调</span></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="keyword">return</span> db_session.query(User).get(<span class="built_in">int</span>(user_id))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare</span>():</span><br><span class="line">    db_session.add(Students(<span class="string">&quot;ban&quot;</span>, <span class="string">&quot;高村&quot;</span>, <span class="string">&quot;13212&quot;</span>))</span><br><span class="line">    db_session.add(Students(<span class="string">&quot;明&quot;</span>, <span class="string">&quot;London&quot;</span>, <span class="string">&quot;98797&quot;</span>))</span><br><span class="line">    db_session.add(Students(<span class="string">&quot;鬼&quot;</span>, <span class="string">&quot;贵&quot;</span>, <span class="string">&quot;6327826&quot;</span>))</span><br><span class="line">    db_session.commit()</span><br><span class="line">    logger.info(<span class="string">&#x27;数据库初始化&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主页面</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册登录退出三件套</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db_session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                user = User(name=form.name.data, pwd=form.pwd.data)</span><br><span class="line">                db_session.add(user)</span><br><span class="line">                db_session.commit()</span><br><span class="line">                flash(<span class="string">&#x27;用户成功注册&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error = <span class="string">&#x27;用户已存在，检查信息或者直接去登录吧&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            user = db_session.query(User).filter_by(name=form.name.data).first()</span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                login_user(user)</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;students.html&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flash(<span class="string">&#x27;用户不在记录内，请重新注册&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;register&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error = form.errors</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续ajax主动请求学生信息所在</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/list&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_list</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        flash(<span class="string">&#x27;登录失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    students = db_session.query(Students).<span class="built_in">all</span>()</span><br><span class="line">    students = [s.jsonformat() <span class="keyword">for</span> s <span class="keyword">in</span> students]</span><br><span class="line">    logger.info(students)</span><br><span class="line">    <span class="keyword">return</span> jsonify(students), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加信息api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        flash(<span class="string">&#x27;登录失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    <span class="comment"># requests.form获取不到表单数据就会报400</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    stu_add = Students(data[<span class="string">&#x27;name&#x27;</span>], data[<span class="string">&#x27;city&#x27;</span>], data[<span class="string">&#x27;phone&#x27;</span>])</span><br><span class="line">    logger.info(stu_add.jsonformat())</span><br><span class="line">    db_session.add(stu_add)</span><br><span class="line">    db_session.commit()</span><br><span class="line">    student = db_session.query(Students).filter_by(name=data[<span class="string">&#x27;name&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> student != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(student.jsonformat()), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;failed&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改api</span></span><br><span class="line"><span class="comment"># 这里还是没处理好，前端需要针对改变项进行识别并提交，id作为不可变项一起提交就好</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/modify&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_the_item</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        flash(<span class="string">&#x27;登录失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    <span class="comment"># 提出来</span></span><br><span class="line">    stu_modify = db_session.query(Students).filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> stu_modify != <span class="literal">None</span>:</span><br><span class="line">        logger.info(<span class="string">&#x27;修改前：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_modify.jsonformat()))</span><br><span class="line">        stu_modify.name, stu_modify.city, stu_modify.phone = data[<span class="string">&#x27;name&#x27;</span>], data[<span class="string">&#x27;city&#x27;</span>], data[<span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">        db_session.commit()</span><br><span class="line">        stu_after = db_session.query(Students).filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">        logger.info(<span class="string">&#x27;修改后：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_after.jsonformat()))</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;got it&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&quot;failed caused it&#x27;s not there&quot;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除api</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_item</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        flash(<span class="string">&#x27;登录失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    data = request.get_json()</span><br><span class="line">    logger.info(<span class="built_in">type</span>(data[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">    stu_delete = db_session.query(Students).filter_by(<span class="built_in">id</span>=data[<span class="string">&#x27;id&#x27;</span>]).first()</span><br><span class="line">    <span class="keyword">if</span> stu_delete != <span class="literal">None</span>:</span><br><span class="line">        logger.info(<span class="string">&#x27;准备删除信息：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(stu_delete.jsonformat()))</span><br><span class="line">        res = db_session.delete(stu_delete)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;删除结果：&#x27;</span>, res)</span><br><span class="line">        db_session.commit()</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&#x27;success&#x27;</span>), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(<span class="string">&quot;failed caused it&#x27;s not there&quot;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        Base.metadata.drop_all(engine)</span><br><span class="line">        Base.metadata.create_all(engine)</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>主体模块就上面这样，然后其他的分块和html部分就不放出来了，直接丢代码仓，免得占字数，看得头疼。</p>
<p>其中遇到一个问题： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlalchemy.exc.ProgrammingError: (sqlite3.ProgrammingError) SQLite objects created in a thread can only be used in that same thread. The object was created in thread id 21004 and this is thread id 6072.</span><br><span class="line">[SQL: SELECT user.id AS user_id, user.name AS user_name, user.pwd AS user_pwd </span><br><span class="line">FROM user </span><br><span class="line">WHERE user.id = ?]</span><br><span class="line">[parameters: [&#123;&#x27;pk_1&#x27;: 1&#125;]]</span><br><span class="line">(Background on this error at: https://sqlalche.me/e/14/f405)</span><br></pre></td></tr></table></figure></p>
<p>然后在创建engine的时候给添加了参数就ok了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engine = create_engine(SQLALCHEMY_DATABASE_URI, connect_args=&#123;<span class="string">&#x27;check_same_thread&#x27;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>没有足够的成形的项目经验支撑，很多东西真的很头疼，关于为什么进行初始化，如何进行初始化都要头疼很久。上面的引入了登录部分以后，两种特色混在一起，数据库初始化都没搞定，登录以后，数据表根本没有注册，app.app_context部分的数据表应该是创建了，但数据添加没完成，放以前可能就是sql的执行了吧，现在好像有其他的做法。然后在网页前端看了，好像又不是那么回事，应该是被flask_login进行安全处理了，啊，我的天，这部分的加密数据还要和前端进行对一下。先放着，如果搞定了，代码仓应该就有更新了，这里就没有待更新了。</p>
<figure>
<img src="/images/加密重定向.png" alt="重定向" />
<figcaption aria-hidden="true">重定向</figcaption>
</figure>
<p><a
target="_blank" rel="noopener" href="https://gitee.com/jacksamu/flask-full-stack/tree/v1.2">代码待更新</a></p>
<h3 id="二全面点的django">二、全面点的django</h3>
<p>Django是一个基于Python的Web框架，它提供了一系列的工具和库，使得开发Web应用变得更加简单和高效。下面是一个Django入门博客，帮助你快速入门Django。</p>
<h3 id="安装django">2.1.1 安装Django</h3>
<p>首先，你需要安装Django。可以使用pip命令来安装Django：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></table></figure>
<h4 id="创建django项目">2.1.2 创建Django项目</h4>
<p>在安装Django之后，你可以使用以下命令来创建一个Django项目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject myproject</span><br></pre></td></tr></table></figure>
<p>这将创建一个名为myproject的Django项目。</p>
<h4 id="创建django应用">2.1.3 创建Django应用</h4>
<p>在Django中，应用是指一个特定的功能模块。你可以使用以下命令来创建一个Django应用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp myapp</span><br></pre></td></tr></table></figure>
<p>这将创建一个名为myapp的Django应用。</p>
<h4 id="编写视图">2.1.4 编写视图</h4>
<p>在Django中，视图是指处理HTTP请求并返回HTTP响应的函数。你可以在myapp/views.py文件中编写视图函数。例如，以下是一个简单的视图函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello, Django!&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="配置url">2.1.5 配置URL</h4>
<p>在Django中，URL是指将HTTP请求映射到视图函数的路径。你可以在myproject/urls.py文件中配置URL。例如，以下是一个简单的URL配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> myapp.views <span class="keyword">import</span> hello</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;hello/&#x27;</span>, hello),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这将将/hello/路径映射到hello视图函数。</p>
<h4 id="运行django应用">2.1.6 运行Django应用</h4>
<p>在完成以上步骤后，你可以使用以下命令来运行Django应用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>
<p>然后它就在8000端口跑起来了。</p>
<h3 id="总结">总结</h3>
<p>现在轻量级的flask大多用来简单建立web服务，提供几个提供业务处理的创建、信息查询、结果查询等接口，用来做起一个网站终究是少，以前的个人认识，它是简单提供web服务的一个后台框架，前台需要用vue，而后台的业务处理中，则是需要用另外的异步库诸如celery，所以早期的认识是一个完好的网站web就是前台vue+flask+celery，但深入了就发现，其实flask本身就能支撑起前台后台，最多就是异步的处理不太够。另外vue也不简单，它只能算是nodejs的前台部分，各种ui设计各个大公司都有着自己独特的脚手架可以搭建，nodejs也能提供简单的后台支持。现在全栈的实现方式越来越多，更多的选择也使得不少人越来越卷，一人兼备多种能力更吃香嘛。</p>
<p>个人发展还是准备熟悉框架，不是具体的flask这种框架，而是各种web框架的大体骨骼，抓住不变的本质就能更快上手明了其他框架，就是所谓的一法通万法，说白了呈现出来的也就一个样子，最多就是随着访问量的提升对并发的要求的指数递增。当实现一个网站非常熟练的时候，就应该有拿得出手的深入到底层的调优处理了。</p>
<p>再往深层一点的挖掘，估计就是个人的深度学习框架的实现，这种才需要结合到实际的数理科学，不然，其实说白了，coder也还是一个组装工程师，不能算更好的实现个人价值，这个算是个人观点吧。</p>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://Jack-samu.github.io">Jack</a>
            <p>原文链接：<a href="https://jack-samu.github.io/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/">https://jack-samu.github.io/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/</a>
            <p>发表日期：<a href="https://jack-samu.github.io/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/">May 3rd 2023, 10:43:30 pm</a>
            <p>更新日期：<a href="https://jack-samu.github.io/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/">March 2nd 2025, 11:34:01 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/2023/05/13/ubuntu%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/" title="ubuntu系统配置记录">
                    <div class="nextTitle">ubuntu系统配置记录</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/2023/04/29/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%B8%80/" title="基础web之一">
                    <div class="prevTitle">基础web之一</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
                <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
    <script>
        let idOption = '1683125010000'
            idOption = location.pathname
        const gitalk = new Gitalk({
            clientID: 'Ov23lip8ZhRIqbSSgHJ9',
            clientSecret: '2a7c5c44e970a6ca9da7a343bcec542a91418c99',
            repo: 'comment',
            owner: 'jack-samu',
            admin: "jack-samu",
            id: idOption,
            distractionFreeMode: false,
            createIssueManually: true,
        })
        gitalk.render('gitalk-container')
    </script>
    <noscript>为正常使用 Gitalk 评论功能，您需要激活 JavaScript</noscript>

            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:pentaJack@163.com" class="iconfont-archer email" title="email" ></a>
                <a href="//github.com/jack-samu" class="iconfont-archer github" target="_blank" title="github"></a>
                <span class="iconfont-archer wechat" title="wechat">
                    <img class="profile-qr" src="/assets/gongzhong.jpg" />
                </span>
                <a href="https://www.zhihu.com/people/JackNUO/posts" class="iconfont-archer zhihu" target="_blank" title="zhihu"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F"><span class="toc-number">1.</span> <span class="toc-text">序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%BD%BB%E4%BE%BF%E7%9A%84flask"><span class="toc-number">1.1.</span> <span class="toc-text">一、轻便的flask</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#flask%E7%9A%84%E5%90%84%E7%A7%8D%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 flask的各种接口的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%91%B8%E4%B8%80%E6%91%B8jinja2%E8%AF%AD%E6%B3%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 摸一摸jinja2语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#flask%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 flask中的数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5mysql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">1.4 引入Mysql数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.4.1 引入用户登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#session%E5%92%8Ccookie"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.4.2 session和cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E7%99%BB%E5%BD%95%E7%9A%84flask_login"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.4.3 用于登录的flask_login</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.4.4 更换实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BA%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.3.</span> <span class="toc-text">1.5 添加了登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%85%A8%E9%9D%A2%E7%82%B9%E7%9A%84django"><span class="toc-number">1.4.</span> <span class="toc-text">二、全面点的django</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85django"><span class="toc-number">1.5.</span> <span class="toc-text">2.1.1 安装Django</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdjango%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.5.1.</span> <span class="toc-text">2.1.2 创建Django项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdjango%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.1.3 创建Django应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%86%E5%9B%BE"><span class="toc-number">1.5.3.</span> <span class="toc-text">2.1.4 编写视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEurl"><span class="toc-number">1.5.4.</span> <span class="toc-text">2.1.5 配置URL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8Cdjango%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.5.</span> <span class="toc-text">2.1.6 运行Django应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 51
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2025 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">03/02</span>
            <a class="archive-post-title" href="/2025/03/02/ubuntu%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">ubuntu安装及配置记录</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/2023/08/02/websocket%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E8%81%8A%E5%A4%A9%E9%80%9A%E4%BF%A1/">websocket实现的一个聊天通信</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span>
            <a class="archive-post-title" href="/2023/07/22/%E7%88%AC%E8%99%AB%E6%97%B6%E7%A2%B0%E5%88%B0br%E5%8A%A0%E8%A7%A3%E5%AF%86/">爬虫时碰到br加解密</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/17</span>
            <a class="archive-post-title" href="/2023/07/17/linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">linux网络编程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/17</span>
            <a class="archive-post-title" href="/2023/07/17/ffmpeg%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/">ffmpeg简单总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/12</span>
            <a class="archive-post-title" href="/2023/07/12/%E5%AF%BC%E8%88%AA%E6%A0%8F%E4%B8%BB%E9%A1%B5%E8%AE%BE%E8%AE%A1/">导航栏主页设计</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/11</span>
            <a class="archive-post-title" href="/2023/07/11/%E5%8D%95%E9%A1%B5%E9%9D%A2blog%E5%85%A8%E6%A0%88%E5%AE%8C%E5%96%84/">单页面blog全栈完善</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span>
            <a class="archive-post-title" href="/2023/07/09/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E4%B9%8B%E5%8D%95%E9%A1%B5%E9%9D%A2blog/">全栈开发之单页面blog</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/05</span>
            <a class="archive-post-title" href="/2023/07/05/%E5%85%A8%E6%A0%88%E4%BC%8A%E5%A7%8B/">全栈伊始</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/26</span>
            <a class="archive-post-title" href="/2023/06/26/sql%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/">sql基础使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/25</span>
            <a class="archive-post-title" href="/2023/06/25/%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E4%B9%8Bc/">序列化和反序列之c++</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/23</span>
            <a class="archive-post-title" href="/2023/06/23/sqlite%E5%9C%A8c-c-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/">sqlite在c/c++中的应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/21</span>
            <a class="archive-post-title" href="/2023/06/21/linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8hook/">linux系统调用hook</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/21</span>
            <a class="archive-post-title" href="/2023/06/21/c++11%E7%BA%BF%E7%A8%8B%E7%89%B9%E6%80%A7/">c++11线程特性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span>
            <a class="archive-post-title" href="/2023/06/20/python%E5%92%8Cc-%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%AE%80%E5%8D%95%E9%80%9A%E4%BF%A1/">python和c++的中间件简单通信</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/19</span>
            <a class="archive-post-title" href="/2023/06/19/python%E5%92%8Cc++%E4%BA%A4%E4%BA%92/">python和c++交互</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/16</span>
            <a class="archive-post-title" href="/2023/06/16/cpp%E5%87%BD%E6%95%B0%E8%87%AA%E5%BA%95%E8%80%8C%E4%B8%8A/">cpp函数自底而上</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/12</span>
            <a class="archive-post-title" href="/2023/06/12/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">十大排序算法(fake)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/11</span>
            <a class="archive-post-title" href="/2023/06/11/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/">进程、线程、协程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/10</span>
            <a class="archive-post-title" href="/2023/06/10/cpp%E5%A4%9A%E6%80%81/">cpp多态</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/06</span>
            <a class="archive-post-title" href="/2023/06/06/cpp%E4%B8%80%E4%BA%9B%E7%B1%BB%E6%A6%82%E5%BF%B5/">cpp一些类概念</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/04</span>
            <a class="archive-post-title" href="/2023/06/04/cpp%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-boost%E5%AE%9E%E7%8E%B0/">cpp网络编程-boost实现</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/03</span>
            <a class="archive-post-title" href="/2023/06/03/websocket%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%8F%8Apython%E5%BA%94%E7%94%A8/">websocket通信以及python应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/02</span>
            <a class="archive-post-title" href="/2023/06/02/cpp%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A5%BD%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/">cpp程序员好用的命令</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2023/05/31/python%E5%A4%9A%E4%BA%BA%E8%81%8A%E5%A4%A9%E5%AE%A4/">python多人聊天室</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2023/05/31/cpp%E9%A2%84%E7%BC%96%E8%AF%91%E6%8C%87%E4%BB%A4/">cpp预编译指令</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span>
            <a class="archive-post-title" href="/2023/05/30/%E4%BB%8Emake%E5%88%B0cmake/">从make到cmake</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/2023/05/26/%E4%BB%8Ec%E4%BB%A3%E7%A0%81%E5%88%B0%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/">从c代码到可执行文件</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/16</span>
            <a class="archive-post-title" href="/2023/05/16/%E8%81%8A%E5%A4%A9%E5%AE%A4%E4%B9%8BC%E8%AF%AD%E8%A8%80%E7%89%88/">聊天室之C语言版</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/16</span>
            <a class="archive-post-title" href="/2023/05/16/cpp%E6%80%BB%E7%BB%93/">cpp总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/2023/05/14/hexo%E8%87%AA%E5%BB%BA%E4%B8%BB%E9%A2%98/">hexo自建主题</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/2023/05/14/%E8%87%AA%E9%80%82%E5%BA%94%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1html%E7%AF%87/">自适应网页设计html篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/13</span>
            <a class="archive-post-title" href="/2023/05/13/ubuntu%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">ubuntu系统配置记录</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/03</span>
            <a class="archive-post-title" href="/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/">基础web之二</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span>
            <a class="archive-post-title" href="/2023/04/29/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%B8%80/">基础web之一</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/2023/04/26/python%E7%9A%84sql%E8%BF%9E%E6%8E%A5/">python的sql连接</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span>
            <a class="archive-post-title" href="/2023/04/24/smtp%E5%92%8Cpop3/">smtp和pop3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/20</span>
            <a class="archive-post-title" href="/2023/04/20/golang%E7%9A%84CLI%E5%BA%94%E7%94%A8/">golang的CLI应用</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/02</span>
            <a class="archive-post-title" href="/2022/12/02/opencv%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">opencv的学习记录</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span>
            <a class="archive-post-title" href="/2022/12/01/c%E5%A4%9A%E8%BF%9B%E7%A8%8B/">c中多进程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/14</span>
            <a class="archive-post-title" href="/2022/11/14/openGL%E5%BA%93%E7%8E%AF%E5%A2%83%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/">c数组和结构体</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/09</span>
            <a class="archive-post-title" href="/2022/11/09/c%E6%95%B0%E7%BB%84%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93/">c数组和结构体</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/02</span>
            <a class="archive-post-title" href="/2022/11/02/c%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/">c流程控制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/27</span>
            <a class="archive-post-title" href="/2022/10/27/c%E4%B8%AD%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/">c中输入输出</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/19</span>
            <a class="archive-post-title" href="/2021/12/19/c++%E7%B1%BB%E5%A4%8D%E4%B9%A0/">c++类复习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/12</span>
            <a class="archive-post-title" href="/2021/12/12/Boost%E5%BA%93%E5%AD%A6%E4%B9%A0_%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86%E7%AF%87/">Boost库学习_时间处理篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/2021/12/06/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E5%9B%9B/">tcp/udp底层实操第四篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/05</span>
            <a class="archive-post-title" href="/2021/12/05/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%B8%89/">tcp/udp底层实操第三篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/04</span>
            <a class="archive-post-title" href="/2021/12/04/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%BA%8C/">tcp/udp底层实操第二篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/03</span>
            <a class="archive-post-title" href="/2021/12/03/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%B8%80/">tcp/udp底层实操第一篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span>
            <a class="archive-post-title" href="/2021/07/22/c++%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/">cpp智能指针</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="c/cpp">
                <span class="iconfont-archer">&#xe606;</span>
                c/cpp
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, c++11">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, c++11
            </span>
            <span class="sidebar-tag-name" data-tags="cpp">
                <span class="iconfont-archer">&#xe606;</span>
                cpp
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, 函数, gdb">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, 函数, gdb
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, 面向对象, 多态">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, 面向对象, 多态
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, 面向对象, GNU, llvm">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, 面向对象, GNU, llvm
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, linux, shell">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, linux, shell
            </span>
            <span class="sidebar-tag-name" data-tags="cpp, boost">
                <span class="iconfont-archer">&#xe606;</span>
                cpp, boost
            </span>
            <span class="sidebar-tag-name" data-tags="c">
                <span class="iconfont-archer">&#xe606;</span>
                c
            </span>
            <span class="sidebar-tag-name" data-tags="c, 多进程">
                <span class="iconfont-archer">&#xe606;</span>
                c, 多进程
            </span>
            <span class="sidebar-tag-name" data-tags="ffmpeg c">
                <span class="iconfont-archer">&#xe606;</span>
                ffmpeg c
            </span>
            <span class="sidebar-tag-name" data-tags="golang, CLI">
                <span class="iconfont-archer">&#xe606;</span>
                golang, CLI
            </span>
            <span class="sidebar-tag-name" data-tags="安防">
                <span class="iconfont-archer">&#xe606;</span>
                安防
            </span>
            <span class="sidebar-tag-name" data-tags="socket c/c++ python">
                <span class="iconfont-archer">&#xe606;</span>
                socket c/c++ python
            </span>
            <span class="sidebar-tag-name" data-tags="c/cpp, openGL, glfw">
                <span class="iconfont-archer">&#xe606;</span>
                c/cpp, openGL, glfw
            </span>
            <span class="sidebar-tag-name" data-tags="python, opencv">
                <span class="iconfont-archer">&#xe606;</span>
                python, opencv
            </span>
            <span class="sidebar-tag-name" data-tags="python, flask, unix-socket, c++">
                <span class="iconfont-archer">&#xe606;</span>
                python, flask, unix-socket, c++
            </span>
            <span class="sidebar-tag-name" data-tags="python, cpp">
                <span class="iconfont-archer">&#xe606;</span>
                python, cpp
            </span>
            <span class="sidebar-tag-name" data-tags="python, flask, flask-sockets-io">
                <span class="iconfont-archer">&#xe606;</span>
                python, flask, flask-sockets-io
            </span>
            <span class="sidebar-tag-name" data-tags="python, sql">
                <span class="iconfont-archer">&#xe606;</span>
                python, sql
            </span>
            <span class="sidebar-tag-name" data-tags="python, smtplib, poplib">
                <span class="iconfont-archer">&#xe606;</span>
                python, smtplib, poplib
            </span>
            <span class="sidebar-tag-name" data-tags="c++ sqlite">
                <span class="iconfont-archer">&#xe606;</span>
                c++ sqlite
            </span>
            <span class="sidebar-tag-name" data-tags="mysql">
                <span class="iconfont-archer">&#xe606;</span>
                mysql
            </span>
            <span class="sidebar-tag-name" data-tags="c, TCP/UDP">
                <span class="iconfont-archer">&#xe606;</span>
                c, TCP/UDP
            </span>
            <span class="sidebar-tag-name" data-tags="ubuntu, docker">
                <span class="iconfont-archer">&#xe606;</span>
                ubuntu, docker
            </span>
            <span class="sidebar-tag-name" data-tags="websocket">
                <span class="iconfont-archer">&#xe606;</span>
                websocket
            </span>
            <span class="sidebar-tag-name" data-tags="websocket, python">
                <span class="iconfont-archer">&#xe606;</span>
                websocket, python
            </span>
            <span class="sidebar-tag-name" data-tags="c, 编译原理">
                <span class="iconfont-archer">&#xe606;</span>
                c, 编译原理
            </span>
            <span class="sidebar-tag-name" data-tags="c/cpp, makefile">
                <span class="iconfont-archer">&#xe606;</span>
                c/cpp, makefile
            </span>
            <span class="sidebar-tag-name" data-tags="vue flask supervisor django">
                <span class="iconfont-archer">&#xe606;</span>
                vue flask supervisor django
            </span>
            <span class="sidebar-tag-name" data-tags="flask django vue">
                <span class="iconfont-archer">&#xe606;</span>
                flask django vue
            </span>
            <span class="sidebar-tag-name" data-tags="数据结构，算法">
                <span class="iconfont-archer">&#xe606;</span>
                数据结构，算法
            </span>
            <span class="sidebar-tag-name" data-tags="flask vue">
                <span class="iconfont-archer">&#xe606;</span>
                flask vue
            </span>
            <span class="sidebar-tag-name" data-tags="html, css">
                <span class="iconfont-archer">&#xe606;</span>
                html, css
            </span>
            <span class="sidebar-tag-name" data-tags="vue">
                <span class="iconfont-archer">&#xe606;</span>
                vue
            </span>
            <span class="sidebar-tag-name" data-tags="c++ protobuf boost">
                <span class="iconfont-archer">&#xe606;</span>
                c++ protobuf boost
            </span>
            <span class="sidebar-tag-name" data-tags="爬虫 br">
                <span class="iconfont-archer">&#xe606;</span>
                爬虫 br
            </span>
            <span class="sidebar-tag-name" data-tags="c, socket, windows, linux">
                <span class="iconfont-archer">&#xe606;</span>
                c, socket, windows, linux
            </span>
            <span class="sidebar-tag-name" data-tags="html, css, js">
                <span class="iconfont-archer">&#xe606;</span>
                html, css, js
            </span>
            <span class="sidebar-tag-name" data-tags="c, cpp, python, 并发">
                <span class="iconfont-archer">&#xe606;</span>
                c, cpp, python, 并发
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://Jack-samu.github.io",
        root: siteMetaRoot,
        author: "Jack"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
            <script src='https://cdn.jsdelivr.net/npm/mermaid@8.11.0/dist/mermaid.min.js' onload="window.mermaid.initialize({theme: 'dark'})" async></script>
    </body>
</html>
