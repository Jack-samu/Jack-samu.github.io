<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Jack">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Jack">
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    <meta name="description" content="小杰的技术博客">
    <meta name="description" content="针对flask框架的学习应用，逐步组装，构建成型项目。">
<meta property="og:type" content="article">
<meta property="og:title" content="flask学习篇">
<meta property="og:url" content="https://jack-samu.github.io/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/index.html">
<meta property="og:site_name" content="Jack &#39;s Studio">
<meta property="og:description" content="针对flask框架的学习应用，逐步组装，构建成型项目。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jack-samu.github.io/images/template_welcome.png">
<meta property="og:image" content="https://jack-samu.github.io/images/%E5%9B%BE%E6%A0%87.png">
<meta property="og:image" content="https://jack-samu.github.io/images/girl_back.png">
<meta property="og:image" content="https://jack-samu.github.io/images/%E5%AF%86%E7%A0%81%E6%A0%A1%E9%AA%8C.png">
<meta property="og:image" content="https://jack-samu.github.io/images/flash%E6%8F%90%E7%A4%BA.png">
<meta property="og:image" content="https://jack-samu.github.io/images/404.jpg">
<meta property="article:published_time" content="2025-03-12T07:33:07.000Z">
<meta property="article:modified_time" content="2025-03-23T12:51:47.891Z">
<meta property="article:author" content="Jack">
<meta property="article:tag" content="python">
<meta property="article:tag" content="flask">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jack-samu.github.io/images/template_welcome.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/avatar/takashi.jpg">
    <title>flask学习篇 · Jack&#39;s Studio</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    <!-- 百度统计  -->
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 7.3.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu">
            <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">Jack's Studio.</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">Jack&#39;s Studio.</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">flask学习篇</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->
    <div class="donate-popup donate-popup--hidden">
    <div class="donate-popup__title">Buy Me A Coffee</div>
    <div class="donate-popup__content">
        <div class="donate-popup__content-description">If this post helped you, please consider buying the author a cup of sugar-free coffee ☕️.</div>
        <img
            class="donate-popup__content-qrCode"
            title="Wechat"
            alt="Wechat"
            src="/assets/donate-wechat.png"
        ></img>
        <img
            class="donate-popup__content-qrCode"
            title="Alipay"
            alt="Alipay"
            src="/assets/donate-alipay.jpg"
        ></img>
    </div>
</div>

    <div
        title="Donate to the author"
        class="footer-fixed-btn footer-fixed-btn--hidden donate-btn"
    >
        <i class="fas fa-donate"></i>
    </div>

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/detail-head.png)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                flask学习篇
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <a class="post-tag" href="javascript:void(0);" data-tags="python">python</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="flask">flask</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">9.2k</span>阅读时长: <span class="post-count reading-time">43 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2025/03/12</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p><font face="楷体"></p>
<p>针对flask框架的学习应用，逐步组装，构建成型项目。</p>
<span id="more"></span>
<h2 id="一哈吉咩">一、哈吉咩</h2>
<p>使用pipenv来进行虚拟环境操作，关于虚拟环境工具，这里有一篇<a
href="https://jack-samu.github.io/2023/06/04/python虚拟环境/">参考</a>。下面开始操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> flask-pra &amp;&amp; <span class="built_in">cd</span> flask-pra</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开始创建虚拟环境</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pipenv shell</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ok</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">Pipfile  Pipfile.lock</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装flask依赖</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pip install flask</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pipenv graph</span></span><br><span class="line">Flask==3.1.0</span><br><span class="line">├── blinker</span><br><span class="line">├── click</span><br><span class="line">├── itsdangerous</span><br><span class="line">├── Jinja2</span><br><span class="line">│   └── MarkupSafe</span><br><span class="line">└── Werkzeug</span><br><span class="line">    └── MarkupSafe</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask --version</span></span><br><span class="line">Python 3.12.7</span><br><span class="line">Flask 3.1.0</span><br><span class="line">Werkzeug 3.1.3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要退出虚拟环境就输入下面命令</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">deactivate</span></span><br></pre></td></tr></table></figure>
<p>有时候pipenv会因为来回创建虚拟环境和试验而有一些问题，这时候可以试着exit当前环境而后再进入虚拟环境来回尝试，失败就退，退出再进。</p>
<p>好的，环境准备完毕，接下来进行开始操作。</p>
<h3 id="创建第一个flask应用">1.1 创建第一个flask应用</h3>
<p>flask是web微框架，主体核心功能为请求响应处理和模板渲染，前者依赖于Werkzeug也就是WSGI工具库完成，后者依赖于Jinja模板渲染库来实现，不过现在应该是Jinja2了。在工作目录下创建如下app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;flask练习&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, world.\n&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">8880</span>)</span><br></pre></td></tr></table></figure>
<p>而后运行项目，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask run</span></span><br><span class="line"> * Debug mode: off</span><br><span class="line">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on http://127.0.0.1:5000</span><br><span class="line">Press CTRL+C to quit</span><br></pre></td></tr></table></figure>
<p>成功运行后，就可以看到对应端口的监听信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netstat和lsof都是进行端口占用的查看工具</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> netstat -tunlp | grep 5000</span></span><br><span class="line">tcp        0      0 127.0.0.1:5000          0.0.0.0:*               LISTEN      363405/python</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> lsof -i:5000</span></span><br><span class="line">COMMAND    PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">flask   363405 jack    3u  IPv4 6104133      0t0  TCP localhost:5000 (LISTEN)</span><br></pre></td></tr></table></figure>
<p>针对这个flask运行服务器进行请求如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl http://localhost:5000/</span></span><br><span class="line">Hello, world.</span><br></pre></td></tr></table></figure>
<p>这便是flask的hello,world了。来解析一下上面代码，上面主要做了两步：引入依赖并创建Flask类实例，使用Flask实例注册了一个针对'/'根地址的处理函数。</p>
<h3 id="解析一下">1.2 解析一下</h3>
<p>重点关注处理函数，这里分两步走，第一步是<code>@app.route('/', methods=['GET'])</code>的装饰器使用，将根地址和处理函数进行绑定，第二步就是处理函数sayhello的实际处理，也就是返回一个"Hello,
world."的字符串。</p>
<blockquote>
<p>从http整体来看，上面服务器运行起来，而后有人发起对该服务器的请求，服务器对请求进行解析，发现了请求url中匹配的是根地址'/'，然后调用处理函数sayhello进行处理；处理函数返回hello,world字符串，服务器将该字符串进行包装，返回给客户端。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```python</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">@app.route(&#x27;/index&#x27;)</span><br><span class="line">@app.route(&#x27;/home&#x27;)</span><br><span class="line">def sayhello():</span><br><span class="line">    return &quot;Hello, world.\n&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/hello/&lt;name&gt;&#x27;)</span><br><span class="line">def sayhi(name):</span><br><span class="line">    return f&quot;Hi, &#123;name&#125;&quot;</span><br></pre></td></tr></table></figure>
<p><strong>坑</strong></p>
<p>仔细去看的话，其实上面的app.py代码并没有完全执行，因为上面设定了服务器运行监听的port实际上是8880，而不是默认的5000，也就是上面代码走的默认路线，这个问题如果通过<code>flask run</code>跑起来，最后运行的只会是项目中的app.py或者wsgi.py文件，路径没错，但没有走我们设定的app.run的路线，实际上上面代码实际上等同于：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;flask练习&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, world.\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>所以，还需要另外进行设定。</p>
<h2 id="二模板">二、模板</h2>
<p>模板是flask主体中的第二主体功能，依赖于Jinja2进行实现，这个功能主旨是对html模板文件进行实体变量填充，从而构造实际的html代码对来端请求进行响应，学习过vue的应该很好理解。如下是一个测试模板文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--test.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; username &#125;&#125;的个人主页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% if right %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; right &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  &#123;# 这里的缩进只是为了可读性，不是必须的 #&#125;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>自我介绍为空。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;  &#123;# 大部分 Jinja 语句都需要声明关闭 #&#125;</span><br></pre></td></tr></table></figure>
<p>如上所示，h1和p都是简单html标签，而这上面添加了Jinja2模板语法而编写就成了一份模板html文件了。</p>
<ul>
<li><code>&#123;&#123;x&#125;&#125;</code>，这用来表示变量，这里面就是x变量；</li>
<li><code>&#123;% ... %&#125;</code>，这里用来标识语句，可以进行if-else这种逻辑判断语句的使用</li>
<li>``````</li>
</ul>
<h3 id="模板使用">2.1 模板使用</h3>
<p>要在flask中进行模板的使用，首先需要在工作目录下创建templates文件夹，因为flask默认会在这里存放模板文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">mkdir</span> templates</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">app.py  Pipfile  templates</span><br></pre></td></tr></table></figure>
<p>下面在templates文件夹中创建一个用来渲染访问主页的模板文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--welcome.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin: auto; height: 100vh;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; user &#125;&#125;的个人主页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome , &#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>而后编辑app.py文件如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">welcome</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;welcome.html&#x27;</span>, user=name)</span><br></pre></td></tr></table></figure>
<p>浏览器访问<code>http://localhost:5000/user/gemini</code>效果如下：</p>
<p><img src="/images/template_welcome.png" /></p>
<blockquote>
<p>如果是在生产环境反复debug，这时候会有不停修修改改，如果针对模板文件有改动，就需要重新运行服务，然后强行刷新浏览器缓存，改动才会生效。</p>
</blockquote>
<p>除了上面的if-else，还可以进行for-endfor来进行迭代循环等使用，Jinja2语法更多查<a
target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/stable/templates/#">官网</a>使用吧，这里不想进行展开了，不过官网上好像是全英的，要注意。</p>
<h3 id="静态文件放置">2.2 静态文件放置</h3>
<p>因为都用上模板html了，那不可避免会有图片啊css样表等引入的，所以这里进行一下静态文件的引入使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">mkdir</span> static</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">app.py  Pipfile  static  templates</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">cd</span> static &amp;&amp; <span class="built_in">mkdir</span> images</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">images</span><br></pre></td></tr></table></figure>
<p>所有网页都有自己的图标，这里随便用一个图片作为这次作业用图标吧，存放一张图片在static下作为这里的使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;url_for(&#x27;static&#x27;, filename=&#x27;favicon.png&#x27;)&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>好的，flask跑起来，看看效果：</p>
<p><img src="/images/图标.png" /></p>
<p>好的，继续加料，往images里面放一张背景图片，再用css样式控制一下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* sample.css */</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./images/girl.jpeg</span>) no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在模板中引入一下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;sample.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/images/girl_back.png" /></p>
<p>好的，内容就这么点，很好懂的，到了这里，当前项目架构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app.py</span><br><span class="line">├── Pipfile</span><br><span class="line">├── static</span><br><span class="line">│   ├── favicon.png</span><br><span class="line">│   ├── images</span><br><span class="line">│   │   └── girl.jpeg</span><br><span class="line">│   └── sample.css</span><br><span class="line">└── templates</span><br><span class="line">    └── welcome.html</span><br></pre></td></tr></table></figure>
<h2 id="三数据库操作">三、数据库操作</h2>
<p>flask这种轻量型的web框架的使用，很多时候需要引入各种插件来实现新增功能，比如这里的数据库操作。数据的存储，比较传统的，还是使用的mysql这种关系型数据库，不过有时候引入外部中间件就需要进行麻烦的安装配置，很头疼，所以如果数据量不大的话，可以考虑使用sqlite这种轻量型的数据库进行作业，一些公司的中台建设就是这样的。</p>
<h3 id="引入sqlite">3.1 引入sqlite</h3>
<p>首先，sqlite的使用，需要进行一下sqlite的安装，因为有时候代码编辑，总归是需要进行数据库操作校验的，有一些会使用可视化工具，这里直接用命令行工具算了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> apt install sqlite3</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqlite3 --version</span></span><br><span class="line">3.46.1 2024-08-13 09:16:08 c9c2ab54ba1f5f46360f1b4f35d849cd3f080e6fc2b6c60e91b16c63f69aalt1 (64-bit)</span><br></pre></td></tr></table></figure>
<p>因为工作机是ubuntu，所以工具安装还是比较方便的。下面为了进行操作演示，就进行一下注册登录的练习吧。</p>
<h3 id="注册登录模板简单实现">3.2 注册登录模板简单实现</h3>
<p>注册登录的前端实现，主要就是进行一个表单数据的提交，而后后端部分进行数据校验和校验通过后的数据存储和结果反馈，前端在收到反馈后，就会进行对应的可视化处理，对用户进行通知。下面先设计一下注册登录的模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;url_for(&#x27;static&#x27;, filename=&#x27;favicon.png&#x27;)&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;msg_box&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if message %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot; background: #999; margin: auto; width: 50%; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户名&quot;</span> <span class="attr">required</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户密码&quot;</span> <span class="attr">required</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码确认：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwordConfirm&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;再次输入密码&quot;</span> <span class="attr">required</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>已有账号？<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-decoration: none;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;padding: 8px 16px;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后是登录表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;url_for(&#x27;static&#x27;, filename=&#x27;favicon.png&#x27;)&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;msg_box&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if message %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot; background: #999; margin: auto; width: 50%; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户名&quot;</span> <span class="attr">required</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户密码&quot;</span> <span class="attr">required</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>未有账号？<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/register&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-decoration: none;&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;padding: 8px 16px;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为这里主体是要进行flask的练习应用，就不进行过多的CSS设计了，引入过多因素会导致失败。</p>
<p>要注意的是，上面添加了一个逻辑判断，实现了一个简单的信息通报。</p>
<h3 id="引入sqlalchemy">3.3 引入sqlalchemy</h3>
<p>在python中，有着sqlalchemy的依赖库可以进行数据库操作，这种操作分成两种：一种是ORM操作，一种是sql命令执行操作。</p>
<p>ORM操作，是在python中定义数据库数据项相关的model类，而后操作这个类就会映射到数据库中；sql命令执行就是获取数据库连接，而后exec这个sql命令来进行增删改查的实现，如下是增删改查简单sql命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 某biao;</span><br><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> 某biao;</span><br><span class="line"><span class="keyword">select</span> col1, col2 <span class="keyword">from</span> 某biao <span class="keyword">where</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> 某biao (col1, col2) <span class="keyword">values</span> (val1, val2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> 某biao <span class="keyword">set</span> col1 <span class="operator">=</span> val1, col2 <span class="operator">=</span> val2;</span><br><span class="line"><span class="keyword">update</span> 某biao <span class="keyword">set</span> col1 <span class="operator">=</span> val1, col2 <span class="operator">=</span> val2 <span class="keyword">where</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 某biao <span class="keyword">where</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>
<p>如上简单sql命令实现增删改查，不过这里采取ORM操作进行数据库的调用，实际上ORM底层也是回归的sql语句的执行而已。安装一下依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pip install flask-sqlalchemy</span></span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pipenv graph</span></span><br><span class="line">Flask-SQLAlchemy==3.1.1</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">└── SQLAlchemy </span><br><span class="line">    ├── greenlet </span><br><span class="line">    └── typing_extensions</span><br></pre></td></tr></table></figure>
<p>flask被称为轻量型的web框架就是因为它只保持主体功能，所以它体量小，但是它同时对外提供了很好的扩展，各种功能的实现都可以通过插件来进行实现，sqlalchemy本来是python一个依赖，对应flask中也有着flask-sqlalchemy的插件依赖来进行对应使用。</p>
<p>在主体app实例中进行flask-sqlalchemy插件初始化，很多插件的时候都需要进行这个初始化操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;flask练习&#x27;</span>)</span><br><span class="line"><span class="comment"># 设置sqlite数据库文件地址，针对数据库部分的配置需要在插件初始化前完成</span></span><br><span class="line">app.config[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>] = <span class="string">&#x27;sqlite:////&#x27;</span> + os.path.join(app.root_path, <span class="string">&#x27;user.db&#x27;</span>)</span><br><span class="line"><span class="comment"># 初始化扩展</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>sqlite的uri设置会因为系统的不同而有所差异，比如因为这里是在ubuntu系统中进行练习，所以是<code>sqlite:////</code>，如果是windows中则是<code>sqlite:///</code>。如此进行，便算是起步作业完成，下面来设计数据库对应的model类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model):</span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">30</span>), unique = <span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">80</span>), nullable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方便print自检</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;id: <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span>, name: <span class="subst">&#123;self.name&#125;</span>, password: <span class="subst">&#123;self.password&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如上设计一个对应数据库user表的model类，而后如下操作创建数据表：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask shell</span></span><br><span class="line">Python 3.12.7 (main, Jan 17 2025, 16:55:27) [GCC 14.2.0] on linux</span><br><span class="line">App: flask练习</span><br><span class="line">Instance: /home/flask-pra/instance</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from app import db</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; db.create_all()</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; <span class="built_in">exit</span>()</span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">app.py  Pipfile  static  templates  user.db</span><br></pre></td></tr></table></figure>
<p>这种办法是手动进行数据表的创建，相对于mysql，sqlite则是一个文件就是一个数据库，创建文件后直接操作创建数据表即可。创表完成后，可以通过sqlite3命令打开user.db文件查看表结构，会发现和上面的model设计一致。</p>
<p>下面针对注册登录进行对应完善，实现后端代码编写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request, redirect, url_for</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        data = request.json</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        user = db.session.query(User).filter_by(name = username).first()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;用户已存在，请登录&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        user_new = User(name=username, password=password)</span><br><span class="line">        db.session.add(user_new)</span><br><span class="line">        db.session.commit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;注册成功，请登录&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        user = db.session.query(User).filter_by(name = username).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;用户不存在，请检查&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> user.password != password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;密码错误，请检查&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;welcome&#x27;</span>, name=username))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>逻辑非常简单，get请求，就返回模板页面，模板表单提交，就进行表单数据获取，然后数据库操作，对数据库数据进行检查，看登录的是不是有这个人，注册的呢，看是否已经注册了这个用户；检查结束就有对应的重定向处理。</p>
<blockquote>
<p>上面要注意的是，因为是使用的html表单，所以对应后端的数据获取，也是使用的request.form来获取，如果是js进行的http请求，方式就会多一点，比如可以进行request.json获取；
&gt;
上面的一个槽点就是url_for，对应的操作对象是函数，很多时候先入为主会觉得是针对路由，真的是。。。。。。</p>
</blockquote>
<p>上面只是一个简单的实现，并不完善，很是丑陋，不过，所有东西先将就一个能用，是吧。总结一下引入flask-sqlalchemy插件后，数据库操作步骤：</p>
<ol type="1">
<li>引入插件，和flask实例进行绑定完成插件初始化；</li>
<li>实现数据库model，并在项目运行起来前进行数据库数据表的创建工作</li>
<li>利用数据库session进行query查、add增、改、删delete等操作。</li>
</ol>
<h2 id="四后端的表单类">四、后端的表单类</h2>
<p>表单是一种数据形式，针对前台的表单数据提交，实际上应该有着表单数据的校验才是，比如密码的长度、用户名的规范、客户输入是否是邮箱等等，这些工作实际上可以在前后端分离中由前端js做了，不过这里只有flask框架，所以就引入一下新插件实现一下表单类吧。</p>
<p>安装一下flask-wtf插件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pip install flask-wtf</span></span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pipenv graph</span></span><br><span class="line">Flask-SQLAlchemy==3.1.1</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">└── SQLAlchemy </span><br><span class="line">    ├── greenlet </span><br><span class="line">    └── typing_extensions </span><br><span class="line">Flask-WTF==1.2.2</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">├── itsdangerous </span><br><span class="line">└── WTForms </span><br><span class="line">    └── MarkupSafe</span><br></pre></td></tr></table></figure>
<p>这是针对表单处理和验证的插件，这是和模板进行搭配使用的，但如果是前端后端分离项目，那么表单的验证和前端页面的实现，就可以放心交给前端部分来进行了，后端主要实现数据操作逻辑和前端请求和反馈处理交互就行。针对上面用户注册登录，设计表单类如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField, PasswordField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired, Length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;flask练习app&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    username = StringField(<span class="string">&#x27;用户名&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">4</span>, <span class="built_in">max</span>=<span class="number">14</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;用户密码：&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">8</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;登录&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>而后改写一下登录模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;msg_box&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if message %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot; background: #999; margin: auto; width: 50%; text-align: center;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.hidden_tag() &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.username.label &#125;&#125;</span><br><span class="line">                &#123;&#123; form.username(size=32) &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.password.label &#125;&#125;</span><br><span class="line">                &#123;&#123; form.password(size=8) &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                &#123;&#123; form.submit() &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就简单很多，而且在模板中，就已经进行了简单的输入规则限制，大概这种效果：</p>
<p><img src="/images/密码校验.png" /></p>
<p>对应的路由函数也该修改一下啦：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.username.data</span><br><span class="line">            password = form.password.data</span><br><span class="line"></span><br><span class="line">            user = db.session.query(User).filter_by(name=name).first()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;用户不存在，确认用户名&quot;</span>, form=form)</span><br><span class="line">            <span class="keyword">if</span> user.password != password:</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;密码错误，请重试&quot;</span>, form=form)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;welcome&#x27;</span>, name=name))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure>
<p>ok，到了这，效果就有了。把注册部分代码也搞定了吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> EqualTo</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    username = StringField(<span class="string">&#x27;用户名&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">4</span>, <span class="built_in">max</span>=<span class="number">14</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;用户密码：&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">8</span>)])</span><br><span class="line">    password_confirm = PasswordField(<span class="string">&#x27;密码确认：&#x27;</span>, validators=[DataRequired(), EqualTo(<span class="string">&#x27;password&#x27;</span>, message=<span class="string">&#x27;密码前后输入需要一致&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;注册&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> flash</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.username.data</span><br><span class="line">            password = form.password.data</span><br><span class="line"></span><br><span class="line">            user = db.session.query(User).filter_by(name=name).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                flash(<span class="string">&quot;用户已存在，请登录&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br><span class="line">            </span><br><span class="line">            user_new = User(name=name, password=password)</span><br><span class="line">            db.session.add(user_new)</span><br><span class="line">            db.session.commit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;auth.login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure>
<p>顺便使用flask的flash闪现来修改一下信息提示窗吧：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;msg_box&quot;</span>&gt;</span></span><br><span class="line">    &#123;% with messages = get_flashed_messages() %&#125;</span><br><span class="line">        &#123;% if messages %&#125;</span><br><span class="line">            &#123;% for message in messages %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>剩下的就和登录页面也差不多的，不补在这占页面啦，flash效果大概就这样：</p>
<p><img src="/images/flash提示.png" /></p>
<h2 id="五加料">五、加料</h2>
<p>毕竟是注册登录，上面却一直用的明文密码，太危险了，需要进行一下加密。</p>
<h3 id="密码加密">5.1 密码加密</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash, check_password_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">            </span><br><span class="line">            password_hash = generate_password_hash(password)</span><br><span class="line">            user_new = User(name=name, password=password_hash)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># ...            </span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_password_hash(user.password, password):</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;密码错误，请重试&quot;</span>, form=form)</span><br></pre></td></tr></table></figure>
<p>如上，在注册的时候将验证通过的用户密码进行hash加密再入库，并且在登录的时候用hash校验函数进行校验。</p>
<h3 id="创建命令行工具">5.2 创建命令行工具</h3>
<p>很多系统都会设计一下自己的子命令来进行一些配合使用，这里也对应创建一个子命令来进行数据表的创建：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--drop&#x27;</span>, is_flag=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;创建数据表之前先清理&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initdb</span>(<span class="params">drop</span>):</span><br><span class="line">    <span class="keyword">if</span> drop:</span><br><span class="line">        db.drop_all()</span><br><span class="line">    db.create_all()</span><br><span class="line">    click.echo(<span class="string">&quot;数据库初始化中。。。。。。&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>而后就可以进行命令操作了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask initdb -d</span></span><br><span class="line">数据库初始化中。。。。。。</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">app.py  command.py  Pipfile  static  templates  user.db</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">sqlite3 user.db</span> </span><br><span class="line">SQLite version 3.46.1 2024-08-13 09:16:08</span><br><span class="line">Enter &quot;.help&quot; for usage hints.</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.table</span></span><br><span class="line">user</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash"><span class="keyword">select</span> * from user;</span></span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.schema user</span></span><br><span class="line">CREATE TABLE user (</span><br><span class="line">        id INTEGER NOT NULL, </span><br><span class="line">        name VARCHAR(30) NOT NULL, </span><br><span class="line">        password VARCHAR(80), </span><br><span class="line">        PRIMARY KEY (id), </span><br><span class="line">        UNIQUE (name)</span><br><span class="line">);</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.<span class="built_in">exit</span></span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span></span><br></pre></td></tr></table></figure>
<p>实际上不带参数也阔以的，这只是一个示范。</p>
<h3 id="添加用户命令">5.3 添加用户命令</h3>
<p>上面子命令创建已经展示，继续新加一个功能吧，针对用户管理的web系统应该有一个可以进行后台操作添加用户的子命令才行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="meta">@app.cli.command(<span class="params"><span class="string">&#x27;create-user&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-u&#x27;</span>, <span class="string">&#x27;--username&#x27;</span>, prompt=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;用户名&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--password&#x27;</span>, prompt=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;用户密码&quot;</span>, hide_input=<span class="literal">True</span>, confirmation_prompt=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="comment"># 防止前面没有进行数据库初始化</span></span><br><span class="line">    db.create_all()</span><br><span class="line"></span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.name==username).first()</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        click.echo(<span class="string">&quot;用户修改。。。。。。&quot;</span>)</span><br><span class="line">        user.password = generate_password_hash(password)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        click.echo(<span class="string">&quot;用户创建中。。。。。。&quot;</span>)</span><br><span class="line">        user = User(name=username, password=generate_password_hash(password))</span><br><span class="line">        db.session.add(user)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    click.echo(<span class="string">&quot;Ok.&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>操作一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask create-user</span></span><br><span class="line">Username: ab</span><br><span class="line">Password: </span><br><span class="line">Repeat for confirmation: </span><br><span class="line">用户创建中。。。。。。</span><br><span class="line">Ok.</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask create-user -u abb -p abb</span></span><br><span class="line">用户创建中。。。。。。</span><br><span class="line">Ok.</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">sqlite3 user.db</span> </span><br><span class="line">SQLite version 3.46.1 2024-08-13 09:16:08</span><br><span class="line">Enter &quot;.help&quot; for usage hints.</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.table</span></span><br><span class="line">user</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash"><span class="keyword">select</span> * from user;</span></span><br><span class="line">1|ab|scrypt:32768:8:1$z3qs4x30v7wXoJK4$81d28bd1d3c9f68caa37327c6840acbb759ee5cee9f3d0520ed52438a73f9b2c01746cfea970e86dbab20c4390f392ddf3c27f28b77843016f6731b3f51ae442</span><br><span class="line">2|abb|scrypt:32768:8:1$cOgEbMTSPOYyfoJ3$3b86b80914b6f1071aee9138b865a789207dc334467a75ab11a3f2c5715fc7db3f20e764904a7ce47dbb2a4c824efd501db3ec07daae7303c0b46987a76b210a</span><br><span class="line"><span class="meta prompt_">sqlite&gt; </span><span class="language-bash">.<span class="built_in">exit</span></span></span><br><span class="line"><span class="meta prompt_">(flask-pra)$</span></span><br></pre></td></tr></table></figure>
<p>好的，使用上没问题，不过这里的修改就牵一发而动全身了，毕竟这里只是后台操作，前台可是有用户名和密码校验的表单的，如果不能输入，就等于没加，所以啊，这里还需要改一改，不过这里就不进行这一步了，我懒。</p>
<h3 id="对于访问的限制">5.4 对于访问的限制</h3>
<p>针对用户登录，就应该有用户登录后才能进行的一些个操作，比如上面login后的重定向用户主页，就应该非登录不可用，所以这里引入flask_login来进行登录保护：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install flask-login</span></span><br></pre></td></tr></table></figure>
<p>而后针对flask-login的使用，修改代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager, UserMixin, login_required, login_user, logout_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;flask练习&#x27;</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">login_manager = LoginManager(app)</span><br><span class="line"><span class="comment"># 添加login路由处理函数为专用登录</span></span><br><span class="line">login_manager.login_view = <span class="string">&#x27;login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承UserMixin，和model类绑定登录的一些常用校验方法，比如</span></span><br><span class="line"><span class="comment"># is_authenticated等</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户加载回调</span></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    user = db_session.get(<span class="built_in">int</span>(user_id))</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line">            login_user(user)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;welcome&#x27;</span>, name=name))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure>
<p>还有就是针对一些需要用户登录方可进行访问的请求，需要对未登录用户进行隐藏，也就是认证保护：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">welcome</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;welcome.html&#x27;</span>, user=name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;sayhello&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>同样的，模板中也可以针对用户登录状态进行检查：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if current_user.is_authenticated %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;logout&#x27;) &#125;&#125;&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;login&#x27;) &#125;&#125;&quot;</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="补上错误处理">5.6 补上错误处理</h3>
<p>编写一下错误页面，看了菜鸟教程的错误页面，感觉挺有意思的，就拿它的图片来作为错误页面算了，编辑404.html如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh;background: url(&#123;&#123;url_for(&#x27;static&#x27;, filename=&quot;</span>/<span class="attr">images</span>/<span class="attr">404.jpg</span>&quot;)&#125;&#125;) <span class="attr">no-repeat</span>;&quot;&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>何もありません。<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后编写错误处理路由函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br></pre></td></tr></table></figure>
<p>背景图如下：</p>
<p><img src="/images/404.jpg" /></p>
<h2 id="六引入蓝图">六、引入蓝图</h2>
<p>蓝图是方便进行代码组织的机制，比如上面的用户登录部分的路由请求，其实都可以说是auth部分的代码，随着功能的逐渐增加，不可能所有代码都放在一份app.py文件中的，理所当然需要进行一下代码划分的，蓝图就是方便进行路由部分的组织管理的，提取上面登录部分内容出来，创建auth蓝图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auth.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, request, render_template, url_for, redirect, flash</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash, check_password_hash</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> login_required, login_user, logout_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model.form <span class="keyword">import</span> RegisterForm, LoginForm</span><br><span class="line"><span class="keyword">from</span> model.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> db_ession</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auth = Blueprint(<span class="string">&#x27;auth&#x27;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route(<span class="params"><span class="string">&#x27;/user/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.username.data</span><br><span class="line">            password = form.password.data</span><br><span class="line"></span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.name == name).first()</span><br><span class="line">            <span class="keyword">if</span> user:</span><br><span class="line">                flash(<span class="string">&quot;用户已存在，请登录&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br><span class="line">            </span><br><span class="line">            password_hash = generate_password_hash(password)</span><br><span class="line">            user_new = User(name=name, password=password_hash)</span><br><span class="line">            db_ession.add(user_new)</span><br><span class="line">            db_ession.commit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;auth.login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route(<span class="params"><span class="string">&#x27;/user/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">            name = form.username.data</span><br><span class="line">            password = form.password.data</span><br><span class="line"></span><br><span class="line">            user = User.query.<span class="built_in">filter</span>(User.name == name).first()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;用户不存在，确认用户名&quot;</span>, form=form)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check_password_hash(user.password, password):</span><br><span class="line">                <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, message=<span class="string">&quot;密码错误，请重试&quot;</span>, form=form)</span><br><span class="line">            </span><br><span class="line">            login_user(user)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;auth.welcome&#x27;</span>, name=name))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;sayhello&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">welcome</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;welcome.html&#x27;</span>, user=name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如上，引入Blueprint实例，而后小改一下注册登录视图和注销视图函数，auth部分就抽取出来了，路由搞定，接下来封装一下model类和表单类，创建model文件夹，编辑__init__.py如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __init__.py</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> scoped_session, sessionmaker, declarative_base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">&#x27;sqlite:///user.db&#x27;</span>)</span><br><span class="line">db_ession = scoped_session(sessionmaker(autocommit=<span class="literal">False</span>, autoflush=<span class="literal">False</span>, bind=engine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line">Base.query = db_ession.query_property()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_db</span>():</span><br><span class="line">    <span class="comment"># 在创表前进行model类引入，否则不会创建user数据表</span></span><br><span class="line">    <span class="keyword">from</span> .models <span class="keyword">import</span> User</span><br><span class="line">    Base.metadata.create_all(bind=engine)</span><br></pre></td></tr></table></figure>
<p>接下来进行model类编辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> UserMixin</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> Base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(Base, UserMixin):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>), unique = <span class="literal">True</span>, nullable=<span class="literal">False</span>)</span><br><span class="line">    password = Column(String(<span class="number">80</span>), nullable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;id: <span class="subst">&#123;self.<span class="built_in">id</span>&#125;</span>, name: <span class="subst">&#123;self.name&#125;</span>, password: <span class="subst">&#123;self.password&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>
<p>喜欢的话，也可以把表单类和model类放一块，不过我习惯了拆分开，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># form.py</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, SubmitField, PasswordField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired, Length, EqualTo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    username = StringField(<span class="string">&#x27;用户名&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">4</span>, <span class="built_in">max</span>=<span class="number">14</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;用户密码：&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">8</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;登录&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    username = StringField(<span class="string">&#x27;用户名&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">4</span>, <span class="built_in">max</span>=<span class="number">14</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;用户密码：&#x27;</span>, validators=[DataRequired(), Length(<span class="built_in">min</span>=<span class="number">8</span>)])</span><br><span class="line">    password_confirm = PasswordField(<span class="string">&#x27;密码确认：&#x27;</span>, validators=[DataRequired(), EqualTo(<span class="string">&#x27;password&#x27;</span>, message=<span class="string">&#x27;密码前后输入需要一致&#x27;</span>)])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;注册&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>然后，重点来了，剩下的app主体部分了，拆开来看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash</span><br><span class="line"><span class="keyword">import</span> click, sys, os</span><br><span class="line"></span><br><span class="line">sys.path.append(os.path.abspath(<span class="string">&quot;.&quot;</span>))</span><br><span class="line"><span class="keyword">from</span> auth <span class="keyword">import</span> auth</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> db_ession, init_db</span><br><span class="line"><span class="keyword">from</span> model.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&#x27;flask练习&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;flask练习app&#x27;</span></span><br><span class="line">login_manager = LoginManager(app)</span><br><span class="line">login_manager.login_view = <span class="string">&#x27;auth.login&#x27;</span></span><br><span class="line">app.register_blueprint(auth)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command(<span class="params"><span class="string">&#x27;create-user&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-u&#x27;</span>, <span class="string">&#x27;--username&#x27;</span>, prompt=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;用户名&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--password&#x27;</span>, prompt=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;用户密码&quot;</span>, hide_input=<span class="literal">True</span>, confirmation_prompt=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="comment"># 防止前面没有进行数据库初始化</span></span><br><span class="line">    init_db()</span><br><span class="line"></span><br><span class="line">    user = User.query.<span class="built_in">filter</span>(User.name==username).first()</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        click.echo(<span class="string">&quot;用户修改。。。。。。&quot;</span>)</span><br><span class="line">        user.password = generate_password_hash(password)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        click.echo(<span class="string">&quot;用户创建中。。。。。。&quot;</span>)</span><br><span class="line">        user = User(name=username, password=generate_password_hash(password))</span><br><span class="line">        db_ession.add(user)</span><br><span class="line">    db_ession.commit()</span><br><span class="line">    click.echo(<span class="string">&quot;Ok.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    user = db_ession.get(User, <span class="built_in">int</span>(user_id))</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_all</span>():</span><br><span class="line">    init_db()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.teardown_appcontext</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shutdown_session</span>(<span class="params">exception=<span class="literal">None</span></span>):</span><br><span class="line">    db_ession.remove()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sayhello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, world.\n&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如上，在app主体中，进行auth蓝图的注册，还有就是关于login_manager对应的登录视图的修改，因为对应登录视图函数挂在auth蓝图中了。</p>
<p>运行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">flask --app app run --port 8880</span></span><br><span class="line"> * Serving Flask app &#x27;app&#x27;</span><br><span class="line"> * Debug mode: off</span><br><span class="line">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on http://127.0.0.1:8880</span><br><span class="line">Press CTRL+C to quit</span><br></pre></td></tr></table></figure>
<p>命令执行的话，通过命令行参数即可制定运行端口和对应flask实例文件也就是入口文件了。到了这里，项目的解构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">pipenv graph</span></span><br><span class="line">Flask-Login==0.6.3</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">└── Werkzeug </span><br><span class="line">    └── MarkupSafe </span><br><span class="line">Flask-SQLAlchemy==3.1.1</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">└── SQLAlchemy </span><br><span class="line">    ├── greenlet </span><br><span class="line">    └── typing_extensions </span><br><span class="line">Flask-WTF==1.2.2</span><br><span class="line">├── Flask </span><br><span class="line">│   ├── blinker </span><br><span class="line">│   ├── click </span><br><span class="line">│   ├── itsdangerous </span><br><span class="line">│   ├── Jinja2 </span><br><span class="line">│   │   └── MarkupSafe </span><br><span class="line">│   └── Werkzeug </span><br><span class="line">│       └── MarkupSafe </span><br><span class="line">├── itsdangerous </span><br><span class="line">└── WTForms </span><br><span class="line">    └── MarkupSafe</span><br><span class="line"><span class="meta prompt_">(flask-pra)$ </span><span class="language-bash">tree .</span></span><br><span class="line">.</span><br><span class="line">├── app.py</span><br><span class="line">├── auth.py</span><br><span class="line">├── model</span><br><span class="line">│   ├── form.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   └── models.py</span><br><span class="line">├── Pipfile</span><br><span class="line">├── static</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   ├── images</span><br><span class="line">│   │   ├── 404.jpg</span><br><span class="line">│   │   └── girl.jpeg</span><br><span class="line">│   └── sample.css</span><br><span class="line">├── templates</span><br><span class="line">│   ├── 404.html</span><br><span class="line">│   ├── login.html</span><br><span class="line">│   ├── register.html</span><br><span class="line">│   └── welcome.html</span><br><span class="line">└── user.db</span><br></pre></td></tr></table></figure>
<h2 id="七单元测试">七、单元测试</h2>
<p>嗯，笔者长久以来的工作习惯都是coder自己负责测试部分，而后测试人员再来进行功能方面的测试，所以这里还是需要添加一下项目的单元测试，因为发行前自检很有必要啊。不过，这部分纯看个人意愿，不喜欢可以跳过。</p>
<h3 id="引入unittest">7.1 引入unittest</h3>
<p>这里采用python标准库中的测试框架unittest来进行单元测试作业的进行。测试的进行主要是进行功能可行性的检验、功能实现函数或方法的执行是否正常，输出是否合乎计划需要。</p>
<p>编辑test.py如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> db_ession, init_db, drop</span><br><span class="line"><span class="keyword">from</span> model.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebTestCase</span>(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 准备工作，数据库部分初始化和测试数据准备</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setUp</span>(<span class="params">self</span>):</span><br><span class="line">        app.config.update(</span><br><span class="line">            TESTING = <span class="literal">True</span>,</span><br><span class="line">            SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;sqlite:////&#x27;</span> + os.path.join(app.root_path, <span class="string">&#x27;user.db&#x27;</span>)</span><br><span class="line">        )</span><br><span class="line">        init_db()</span><br><span class="line">        user = User(name=<span class="string">&quot;哑巴阿巴&quot;</span>, password=<span class="string">&quot;aaaabbbb&quot;</span>)</span><br><span class="line">        db_ession.add(user)</span><br><span class="line">        db_ession.commit()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建测试用client</span></span><br><span class="line">        <span class="variable language_">self</span>.client = app.test_client()</span><br><span class="line">        <span class="comment"># 创建测试用命令运行器</span></span><br><span class="line">        <span class="variable language_">self</span>.runner = app.test_cli_runner()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试完成的清理工作</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tearDown</span>(<span class="params">self</span>):</span><br><span class="line">        db_ession.remove()</span><br><span class="line">        drop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试程序实例是否存在</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_app_exist</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.assertIsNotNone(app)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 测试程序是否处于测试模式</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_app_is_testing</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.assertTrue(app.config[<span class="string">&#x27;TESTING&#x27;</span>])</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>以上主要是编写测试类，而后由unittest来拉起测试，测试用例是继承了unittest.TestCase的类，其中setUp和tearDown都是固定的方法，前者可以为测试做准备作业，后者可以做清理作业，而我们真正要进行的测试主体是test_开头的方法，比如上面的test_app_exist和test_app_is_testing。</p>
<p>简单介绍也就这样，下面来进行实打实的测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WebTestCase</span>(unittest.TestCase):</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_home_page</span>(<span class="params">self</span>):</span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        data = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(resp.status_code, <span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;Hello, world.\n&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">        data = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(resp.status_code, <span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;Hello, world.\n&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line">        data = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(resp.status_code, <span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;Hello, world.\n&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_404_page</span>(<span class="params">self</span>):</span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/阿巴阿巴&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(resp.status_code, <span class="number">404</span>)</span><br><span class="line"></span><br><span class="line">        data = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;何もありません。&quot;</span>, data)</span><br></pre></td></tr></table></figure>
<p>添加两个测试方法，针对上面flask项目中主页和错误页面的功能进行测试，主页因为是返回<code>Hello,world\n</code>字符串，所以检测请求主页得到的data里面是否有<code>Hello,world\n</code>即可，而404就更简单了，随便访问一个未定义的路由，就会触发项目的404处理了，跑一下看看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(tutorial)$ </span><span class="language-bash">python test.py</span> </span><br><span class="line">....</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 4 tests in 0.087s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>因为上面一共定义了四个<code>test_</code>方法，所以上面结果就是执行了四次test，这算是我们的预定测试通过了，那么，如果测试不通过会怎样呢？修改一下上面的<code>test_404_page</code>方法，把检查字符是否存在的assertIn修改为assertEqual，再来执行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">(tutorial)$ </span><span class="language-bash">python test.py</span> </span><br><span class="line">F...</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_404_page (__main__.PageTestCase.test_404_page)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/tutorial/flaskPra/test.py&quot;, line 62, in test_404_page</span><br><span class="line">    self.assertEqual(&quot;何もありません。&quot;, data)</span><br><span class="line">AssertionError: &#x27;何もありません。&#x27; != &#x27;&lt;div style=&quot;height: 100vh;background: url[65 chars]div&gt;&#x27;</span><br><span class="line">- 何もありません。</span><br><span class="line">+ &lt;div style=&quot;height: 100vh;background: url(/static//images/404.jpg) no-repeat;&quot;&gt;</span><br><span class="line">+     &lt;h1&gt;何もありません。&lt;/h1&gt;</span><br><span class="line">+ &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 4 tests in 0.086s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br></pre></td></tr></table></figure>
<p>这样就是一个与设定相悖的测试方法得到的结果了，但如果我们按照需求来进行理想测试，这种情况就是我们代码需要改进的地方了。下面进行用户注册登录方面的测试，因为注册登录页面的实现，应用了FlaskForm来进行表单设计，而模板中又引入了该表单的<code>&#123;&#123; form.hidden_tag() &#125;&#125;</code>来提供csrf保护，后台对表单数据也是从该表单类中进行数据提取的，因此，表单提交需要带着csrf_token去进行：</p>
<p>做法上就是先进行注册和登录的get请求，获取表单，然后提取csrf_token来进行表单post。经渲染后的html模板是这样的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrf_token&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ImQyZDQ1M2YzZDE2Mjk3NjNmOGY3OTdhMTBiYjY3MjMyNGEyMTdkNDki.Z9BO3Q.vYxmEr2tjWsE3FTngdW6tg8kLUI&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;14&quot;</span> <span class="attr">minlength</span>=<span class="string">&quot;4&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">required</span> <span class="attr">size</span>=<span class="string">&quot;32&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>用户密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">minlength</span>=<span class="string">&quot;8&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">required</span> <span class="attr">size</span>=<span class="string">&quot;8&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password_confirm&quot;</span>&gt;</span>密码确认：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password_confirm&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password_confirm&quot;</span> <span class="attr">required</span> <span class="attr">size</span>=<span class="string">&quot;8&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>抓住重点，我们要的是name属性为csrf_token的input标签的value，这里就是我们要的csrf_token，对应获取思路如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">resp = requests.get(<span class="string">&quot;http://localhost:8880/user/register&quot;</span>)</span><br><span class="line">doc = pq(resp.text)</span><br><span class="line">csrf_token = doc(<span class="string">&#x27;input[name=&quot;csrf_token&quot;]&#x27;</span>).attr(<span class="string">&#x27;value&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>引入了pyquery库来进行html数据提取，应用在单元测试中，使用前记得进行下载：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PageTestCase</span>(unittest.TestCase):</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_auth_register</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="comment"># 引入了Flask-wtf的csrf-token，所以需要csrf_token</span></span><br><span class="line">            resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/user/register&#x27;</span>)</span><br><span class="line">            <span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">            doc = pq(resp.text)</span><br><span class="line">            csrf_token = doc(<span class="string">&#x27;input[name=&quot;csrf_token&quot;]&#x27;</span>).attr(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">            <span class="comment"># 检查正确输入是否通过并入库</span></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;csrf_token&#x27;</span>: csrf_token,</span><br><span class="line">                <span class="string">&quot;username&quot;</span> : <span class="string">&#x27;夏目贵志&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span> : <span class="string">&#x27;miaomiao&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;password_confirm&quot;</span> : <span class="string">&#x27;miaomiao&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            resp = <span class="variable language_">self</span>.client.post(<span class="string">&#x27;/user/register&#x27;</span>, data=data, follow_redirects=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.assertIn(<span class="string">&quot;登录&quot;</span>, resp.get_data(as_text=<span class="literal">True</span>))</span><br><span class="line">            user_new = User.query.<span class="built_in">filter</span>(User.name == <span class="string">&#x27;夏目贵志&#x27;</span>).first()</span><br><span class="line">            <span class="variable language_">self</span>.assertTrue(check_password_hash(user_new.password, <span class="string">&#x27;miaomiao&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 测试用初始化添加的用户进行注册</span></span><br><span class="line">            data[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;哑巴阿巴&#x27;</span></span><br><span class="line">            data[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;aaaabbbb&#x27;</span></span><br><span class="line">            resp = <span class="variable language_">self</span>.client.post(<span class="string">&#x27;/user/register&#x27;</span>, data=data, follow_redirects=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.assertIn(<span class="string">&quot;注册&quot;</span>, resp.get_data(as_text=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<p>好的，测试通过：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(tutorial)$ python test.py </span><br><span class="line">.....</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">Ran <span class="number">5</span> tests <span class="keyword">in</span> <span class="number">1.283</span>s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>登录部分按照同样的流程来进行即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_auth_login</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 检查正确输入是否通过</span></span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/user/login&#x27;</span>)</span><br><span class="line">        <span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">        doc = pq(resp.text)</span><br><span class="line">        csrf_token = doc(<span class="string">&#x27;input[name=&quot;csrf_token&quot;]&#x27;</span>).attr(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;csrf_token&#x27;</span>: csrf_token,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> : <span class="string">&#x27;哑巴阿巴&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> : <span class="string">&#x27;aaaabbbb&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        resp = <span class="variable language_">self</span>.client.post(<span class="string">&#x27;/user/login&#x27;</span>, data=data, follow_redirects=<span class="literal">True</span>)</span><br><span class="line">        text = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;哑巴阿巴的个人主页&quot;</span>, text)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;logout&quot;</span>, text)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 进行logout然后访问welcome页面，验证是否进行登录保护</span></span><br><span class="line">        <span class="comment"># 要添加 , follow_redirects=True，否则会没法跟随重定向</span></span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/logout&#x27;</span>, follow_redirects=<span class="literal">True</span>)</span><br><span class="line">        text = resp.get_data(as_text=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;Hello, world&quot;</span>, text)</span><br><span class="line">        resp = <span class="variable language_">self</span>.client.get(<span class="string">&#x27;/user/哑巴阿巴&#x27;</span>, follow_redirects=<span class="literal">True</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIn(<span class="string">&quot;登录&quot;</span>, resp.get_data(as_text=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<p>ok，到这就算over了，大体上要的就是这样的效果。</p>
<h2 id="终">终</h2>
<p>这就是一次针对flask项目的知识点学习的一次练习了，什么？前端设计太丑了？咳咳，这flask毕竟是后端web框架，主要验证flask功能，不要在意这些细节。什么？细节很重要？行吧，我聋了，没听到。</p>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>原文作者：<a href="https://Jack-samu.github.io">Jack</a>
            <p>原文链接：<a href="https://jack-samu.github.io/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/">https://jack-samu.github.io/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/</a>
            <p>发表日期：<a href="https://jack-samu.github.io/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/">March 12th 2025, 3:33:07 pm</a>
            <p>更新日期：<a href="https://jack-samu.github.io/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/">March 23rd 2025, 8:51:47 pm</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/2025/03/12/django%E5%AD%A6%E4%B9%A0%E7%AF%87/" title="django学习篇">
                    <div class="nextTitle">django学习篇</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/2025/03/12/Mysql%E5%AE%89%E8%A3%85/" title="Mysql安装">
                    <div class="prevTitle">Mysql安装</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->
    <script src='https://utteranc.es/client.js'
        repo='Jack-samu/comment'
        issue-term='title'
        label='Comment'
        theme='github-light'
        crossorigin='anonymous'
        async>
    </script>

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:pentaJack@163.com" class="iconfont-archer email" title="email" ></a>
                <a href="//github.com/jack-samu" class="iconfont-archer github" target="_blank" title="github"></a>
                <span class="iconfont-archer wechat" title="wechat">
                    <img class="profile-qr" src="/assets/gongzhong.jpg" />
                </span>
                <a href="https://www.zhihu.com/people/JackNUO/posts" class="iconfont-archer zhihu" target="_blank" title="zhihu"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%93%88%E5%90%89%E5%92%A9"><span class="toc-number">1.</span> <span class="toc-text">一、哈吉咩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AAflask%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 创建第一个flask应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E4%B8%80%E4%B8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 解析一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.</span> <span class="toc-text">二、模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 模板使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%94%BE%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 静态文件放置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">三、数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5sqlite"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 引入sqlite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E6%9D%BF%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 注册登录模板简单实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5sqlalchemy"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 引入sqlalchemy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E5%90%8E%E7%AB%AF%E7%9A%84%E8%A1%A8%E5%8D%95%E7%B1%BB"><span class="toc-number">4.</span> <span class="toc-text">四、后端的表单类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E5%8A%A0%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">五、加料</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 密码加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 创建命令行工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 添加用户命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E8%AE%BF%E9%97%AE%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 对于访问的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%8A%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.5.</span> <span class="toc-text">5.6 补上错误处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E5%BC%95%E5%85%A5%E8%93%9D%E5%9B%BE"><span class="toc-number">6.</span> <span class="toc-text">六、引入蓝图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">七、单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5unittest"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 引入unittest</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%88"><span class="toc-number">8.</span> <span class="toc-text">终</span></a></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 55
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2025 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">03/13</span>
            <a class="archive-post-title" href="/2025/03/13/fastapi%E5%AD%A6%E4%B9%A0%E7%AF%87/">fastapi学习篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span>
            <a class="archive-post-title" href="/2025/03/12/Mysql%E5%AE%89%E8%A3%85/">Mysql安装</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span>
            <a class="archive-post-title" href="/2025/03/12/django%E5%AD%A6%E4%B9%A0%E7%AF%87/">django学习篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/12</span>
            <a class="archive-post-title" href="/2025/03/12/flask%E5%AD%A6%E4%B9%A0%E7%AF%87/">flask学习篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/02</span>
            <a class="archive-post-title" href="/2025/03/02/ubuntu%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">ubuntu安装及配置记录</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/2023/08/02/websocket%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E8%81%8A%E5%A4%A9%E9%80%9A%E4%BF%A1/">websocket实现的一个聊天通信</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span>
            <a class="archive-post-title" href="/2023/07/22/%E7%88%AC%E8%99%AB%E6%97%B6%E7%A2%B0%E5%88%B0br%E5%8A%A0%E8%A7%A3%E5%AF%86/">爬虫时碰到br加解密</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/17</span>
            <a class="archive-post-title" href="/2023/07/17/linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">linux网络编程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/17</span>
            <a class="archive-post-title" href="/2023/07/17/ffmpeg%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/">ffmpeg简单总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/12</span>
            <a class="archive-post-title" href="/2023/07/12/%E5%AF%BC%E8%88%AA%E6%A0%8F%E4%B8%BB%E9%A1%B5%E8%AE%BE%E8%AE%A1/">导航栏主页设计</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/11</span>
            <a class="archive-post-title" href="/2023/07/11/%E5%8D%95%E9%A1%B5%E9%9D%A2blog%E5%85%A8%E6%A0%88%E5%AE%8C%E5%96%84/">单页面blog全栈完善</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span>
            <a class="archive-post-title" href="/2023/07/09/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E4%B9%8B%E5%8D%95%E9%A1%B5%E9%9D%A2blog/">全栈开发之单页面blog</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/05</span>
            <a class="archive-post-title" href="/2023/07/05/%E5%85%A8%E6%A0%88%E4%BC%8A%E5%A7%8B/">全栈伊始</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/26</span>
            <a class="archive-post-title" href="/2023/06/26/sql%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/">sql基础使用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/25</span>
            <a class="archive-post-title" href="/2023/06/25/%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E4%B9%8Bc/">序列化和反序列之c++</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/23</span>
            <a class="archive-post-title" href="/2023/06/23/sqlite%E5%9C%A8c-c-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/">sqlite在c/c++中的应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/21</span>
            <a class="archive-post-title" href="/2023/06/21/linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8hook/">linux系统调用hook</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/21</span>
            <a class="archive-post-title" href="/2023/06/21/c++11%E7%BA%BF%E7%A8%8B%E7%89%B9%E6%80%A7/">c++11线程特性</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span>
            <a class="archive-post-title" href="/2023/06/20/python%E5%92%8Cc-%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%AE%80%E5%8D%95%E9%80%9A%E4%BF%A1/">python和c++的中间件简单通信</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/19</span>
            <a class="archive-post-title" href="/2023/06/19/python%E5%92%8Cc++%E4%BA%A4%E4%BA%92/">python和c++交互</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/16</span>
            <a class="archive-post-title" href="/2023/06/16/cpp%E5%87%BD%E6%95%B0%E8%87%AA%E5%BA%95%E8%80%8C%E4%B8%8A/">cpp函数自底而上</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/12</span>
            <a class="archive-post-title" href="/2023/06/12/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">十大排序算法(fake)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/11</span>
            <a class="archive-post-title" href="/2023/06/11/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/">进程、线程、协程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/10</span>
            <a class="archive-post-title" href="/2023/06/10/cpp%E5%A4%9A%E6%80%81/">cpp多态</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/06</span>
            <a class="archive-post-title" href="/2023/06/06/cpp%E4%B8%80%E4%BA%9B%E7%B1%BB%E6%A6%82%E5%BF%B5/">cpp一些类概念</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/04</span>
            <a class="archive-post-title" href="/2023/06/04/cpp%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-boost%E5%AE%9E%E7%8E%B0/">cpp网络编程-boost实现</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/03</span>
            <a class="archive-post-title" href="/2023/06/03/websocket%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%8F%8Apython%E5%BA%94%E7%94%A8/">websocket通信以及python应用</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/02</span>
            <a class="archive-post-title" href="/2023/06/02/cpp%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A5%BD%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/">cpp程序员好用的命令</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2023/05/31/python%E5%A4%9A%E4%BA%BA%E8%81%8A%E5%A4%A9%E5%AE%A4/">python多人聊天室</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2023/05/31/cpp%E9%A2%84%E7%BC%96%E8%AF%91%E6%8C%87%E4%BB%A4/">cpp预编译指令</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/30</span>
            <a class="archive-post-title" href="/2023/05/30/%E4%BB%8Emake%E5%88%B0cmake/">从make到cmake</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/2023/05/26/%E4%BB%8Ec%E4%BB%A3%E7%A0%81%E5%88%B0%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/">从c代码到可执行文件</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/16</span>
            <a class="archive-post-title" href="/2023/05/16/%E8%81%8A%E5%A4%A9%E5%AE%A4%E4%B9%8BC%E8%AF%AD%E8%A8%80%E7%89%88/">聊天室之C语言版</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/16</span>
            <a class="archive-post-title" href="/2023/05/16/cpp%E6%80%BB%E7%BB%93/">cpp总结</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/2023/05/14/hexo%E8%87%AA%E5%BB%BA%E4%B8%BB%E9%A2%98/">hexo自建主题</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/2023/05/14/%E8%87%AA%E9%80%82%E5%BA%94%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1html%E7%AF%87/">自适应网页设计html篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/13</span>
            <a class="archive-post-title" href="/2023/05/13/ubuntu%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">ubuntu系统配置记录</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/03</span>
            <a class="archive-post-title" href="/2023/05/03/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%BA%8C/">基础web之二</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span>
            <a class="archive-post-title" href="/2023/04/29/%E5%9F%BA%E7%A1%80web%E4%B9%8B%E4%B8%80/">基础web之一</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/2023/04/26/python%E7%9A%84sql%E8%BF%9E%E6%8E%A5/">python的sql连接</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span>
            <a class="archive-post-title" href="/2023/04/24/smtp%E5%92%8Cpop3/">smtp和pop3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/20</span>
            <a class="archive-post-title" href="/2023/04/20/golang%E7%9A%84CLI%E5%BA%94%E7%94%A8/">golang的CLI应用</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/02</span>
            <a class="archive-post-title" href="/2022/12/02/opencv%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">opencv的学习记录</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span>
            <a class="archive-post-title" href="/2022/12/01/c%E5%A4%9A%E8%BF%9B%E7%A8%8B/">c中多进程</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/14</span>
            <a class="archive-post-title" href="/2022/11/14/openGL%E5%BA%93%E7%8E%AF%E5%A2%83%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/">c数组和结构体</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/09</span>
            <a class="archive-post-title" href="/2022/11/09/c%E6%95%B0%E7%BB%84%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93/">c数组和结构体</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/02</span>
            <a class="archive-post-title" href="/2022/11/02/c%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/">c流程控制</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/27</span>
            <a class="archive-post-title" href="/2022/10/27/c%E4%B8%AD%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/">c中输入输出</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/19</span>
            <a class="archive-post-title" href="/2021/12/19/c++%E7%B1%BB%E5%A4%8D%E4%B9%A0/">c++类复习</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/12</span>
            <a class="archive-post-title" href="/2021/12/12/Boost%E5%BA%93%E5%AD%A6%E4%B9%A0_%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86%E7%AF%87/">Boost库学习_时间处理篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/2021/12/06/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E5%9B%9B/">tcp/udp底层实操第四篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/05</span>
            <a class="archive-post-title" href="/2021/12/05/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%B8%89/">tcp/udp底层实操第三篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/04</span>
            <a class="archive-post-title" href="/2021/12/04/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%BA%8C/">tcp/udp底层实操第二篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/03</span>
            <a class="archive-post-title" href="/2021/12/03/tcp&udp%E5%BA%95%E5%B1%82%E5%AE%9E%E6%93%8D%E4%B9%8B%E4%B8%80/">tcp/udp底层实操第一篇</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span>
            <a class="archive-post-title" href="/2021/07/22/c++%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/">cpp智能指针</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="c">
                <span class="iconfont-archer">&#xe606;</span>
                c
            </span>
            <span class="sidebar-tag-name" data-tags="cpp">
                <span class="iconfont-archer">&#xe606;</span>
                cpp
            </span>
            <span class="sidebar-tag-name" data-tags="Mysql">
                <span class="iconfont-archer">&#xe606;</span>
                Mysql
            </span>
            <span class="sidebar-tag-name" data-tags="docker">
                <span class="iconfont-archer">&#xe606;</span>
                docker
            </span>
            <span class="sidebar-tag-name" data-tags="c++11">
                <span class="iconfont-archer">&#xe606;</span>
                c++11
            </span>
            <span class="sidebar-tag-name" data-tags="面向对象">
                <span class="iconfont-archer">&#xe606;</span>
                面向对象
            </span>
            <span class="sidebar-tag-name" data-tags="GNU">
                <span class="iconfont-archer">&#xe606;</span>
                GNU
            </span>
            <span class="sidebar-tag-name" data-tags="llvm">
                <span class="iconfont-archer">&#xe606;</span>
                llvm
            </span>
            <span class="sidebar-tag-name" data-tags="函数">
                <span class="iconfont-archer">&#xe606;</span>
                函数
            </span>
            <span class="sidebar-tag-name" data-tags="gdb">
                <span class="iconfont-archer">&#xe606;</span>
                gdb
            </span>
            <span class="sidebar-tag-name" data-tags="多态">
                <span class="iconfont-archer">&#xe606;</span>
                多态
            </span>
            <span class="sidebar-tag-name" data-tags="linux">
                <span class="iconfont-archer">&#xe606;</span>
                linux
            </span>
            <span class="sidebar-tag-name" data-tags="shell">
                <span class="iconfont-archer">&#xe606;</span>
                shell
            </span>
            <span class="sidebar-tag-name" data-tags="boost">
                <span class="iconfont-archer">&#xe606;</span>
                boost
            </span>
            <span class="sidebar-tag-name" data-tags="多进程">
                <span class="iconfont-archer">&#xe606;</span>
                多进程
            </span>
            <span class="sidebar-tag-name" data-tags="python">
                <span class="iconfont-archer">&#xe606;</span>
                python
            </span>
            <span class="sidebar-tag-name" data-tags="django">
                <span class="iconfont-archer">&#xe606;</span>
                django
            </span>
            <span class="sidebar-tag-name" data-tags="fastapi">
                <span class="iconfont-archer">&#xe606;</span>
                fastapi
            </span>
            <span class="sidebar-tag-name" data-tags="ffmpeg">
                <span class="iconfont-archer">&#xe606;</span>
                ffmpeg
            </span>
            <span class="sidebar-tag-name" data-tags="flask">
                <span class="iconfont-archer">&#xe606;</span>
                flask
            </span>
            <span class="sidebar-tag-name" data-tags="golang">
                <span class="iconfont-archer">&#xe606;</span>
                golang
            </span>
            <span class="sidebar-tag-name" data-tags="CLI">
                <span class="iconfont-archer">&#xe606;</span>
                CLI
            </span>
            <span class="sidebar-tag-name" data-tags="hexo">
                <span class="iconfont-archer">&#xe606;</span>
                hexo
            </span>
            <span class="sidebar-tag-name" data-tags="hook">
                <span class="iconfont-archer">&#xe606;</span>
                hook
            </span>
            <span class="sidebar-tag-name" data-tags="socket">
                <span class="iconfont-archer">&#xe606;</span>
                socket
            </span>
            <span class="sidebar-tag-name" data-tags="openGL">
                <span class="iconfont-archer">&#xe606;</span>
                openGL
            </span>
            <span class="sidebar-tag-name" data-tags="glfw">
                <span class="iconfont-archer">&#xe606;</span>
                glfw
            </span>
            <span class="sidebar-tag-name" data-tags="opencv">
                <span class="iconfont-archer">&#xe606;</span>
                opencv
            </span>
            <span class="sidebar-tag-name" data-tags="unix-socket">
                <span class="iconfont-archer">&#xe606;</span>
                unix-socket
            </span>
            <span class="sidebar-tag-name" data-tags="flask-sockets-io">
                <span class="iconfont-archer">&#xe606;</span>
                flask-sockets-io
            </span>
            <span class="sidebar-tag-name" data-tags="sql">
                <span class="iconfont-archer">&#xe606;</span>
                sql
            </span>
            <span class="sidebar-tag-name" data-tags="smtplib">
                <span class="iconfont-archer">&#xe606;</span>
                smtplib
            </span>
            <span class="sidebar-tag-name" data-tags="poplib">
                <span class="iconfont-archer">&#xe606;</span>
                poplib
            </span>
            <span class="sidebar-tag-name" data-tags="sqlite">
                <span class="iconfont-archer">&#xe606;</span>
                sqlite
            </span>
            <span class="sidebar-tag-name" data-tags="mysql">
                <span class="iconfont-archer">&#xe606;</span>
                mysql
            </span>
            <span class="sidebar-tag-name" data-tags="TCP/UDP">
                <span class="iconfont-archer">&#xe606;</span>
                TCP/UDP
            </span>
            <span class="sidebar-tag-name" data-tags="ubuntu">
                <span class="iconfont-archer">&#xe606;</span>
                ubuntu
            </span>
            <span class="sidebar-tag-name" data-tags="websocket">
                <span class="iconfont-archer">&#xe606;</span>
                websocket
            </span>
            <span class="sidebar-tag-name" data-tags="编译原理">
                <span class="iconfont-archer">&#xe606;</span>
                编译原理
            </span>
            <span class="sidebar-tag-name" data-tags="c/cpp">
                <span class="iconfont-archer">&#xe606;</span>
                c/cpp
            </span>
            <span class="sidebar-tag-name" data-tags="makefile">
                <span class="iconfont-archer">&#xe606;</span>
                makefile
            </span>
            <span class="sidebar-tag-name" data-tags="vue">
                <span class="iconfont-archer">&#xe606;</span>
                vue
            </span>
            <span class="sidebar-tag-name" data-tags="supervisor">
                <span class="iconfont-archer">&#xe606;</span>
                supervisor
            </span>
            <span class="sidebar-tag-name" data-tags="数据结构，算法">
                <span class="iconfont-archer">&#xe606;</span>
                数据结构，算法
            </span>
            <span class="sidebar-tag-name" data-tags="html">
                <span class="iconfont-archer">&#xe606;</span>
                html
            </span>
            <span class="sidebar-tag-name" data-tags="css">
                <span class="iconfont-archer">&#xe606;</span>
                css
            </span>
            <span class="sidebar-tag-name" data-tags="protobuf">
                <span class="iconfont-archer">&#xe606;</span>
                protobuf
            </span>
            <span class="sidebar-tag-name" data-tags="爬虫">
                <span class="iconfont-archer">&#xe606;</span>
                爬虫
            </span>
            <span class="sidebar-tag-name" data-tags="br">
                <span class="iconfont-archer">&#xe606;</span>
                br
            </span>
            <span class="sidebar-tag-name" data-tags="windows">
                <span class="iconfont-archer">&#xe606;</span>
                windows
            </span>
            <span class="sidebar-tag-name" data-tags="js">
                <span class="iconfont-archer">&#xe606;</span>
                js
            </span>
            <span class="sidebar-tag-name" data-tags="并发">
                <span class="iconfont-archer">&#xe606;</span>
                并发
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://Jack-samu.github.io",
        root: siteMetaRoot,
        author: "Jack"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
            <script src='https://cdn.jsdelivr.net/npm/mermaid@8.11.0/dist/mermaid.min.js' onload="window.mermaid.initialize({theme: 'dark'})" async></script>
    </body>
</html>
